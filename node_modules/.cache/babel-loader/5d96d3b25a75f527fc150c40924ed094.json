{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reducer = exports.combineReducers = void 0;\nvar logger_1 = __importDefault(require(\"../logger\"));\nvar types_1 = require(\"../types\");\nvar utils_1 = require(\"./utils\");\nvar status_1 = require(\"../utils/status\");\nvar combineReducers = function combineReducers() {\n  for (var _len = arguments.length, reducers = new Array(_len), _key = 0; _key < _len; _key++) {\n    reducers[_key] = arguments[_key];\n  }\n  return function (state, action) {\n    return reducers.reduce(function (newState, reducer) {\n      return reducer(newState, action);\n    }, state);\n  };\n};\nexports.combineReducers = combineReducers;\nvar reducer = function reducer(state, action) {\n  var _a;\n  var gatewayStatus = (0, utils_1.statusFromToken)(state, state.gatewayToken) || types_1.GatewayStatus.UNKNOWN;\n  var updatedState = Object.assign(Object.assign({}, state), {\n    gatewayStatus: gatewayStatus\n  });\n  // eslint-disable-next-line no-prototype-builtins\n  var tokenCreationInProgress = !!((_a = updatedState.civicPass.responsePayload) === null || _a === void 0 ? void 0 : _a.hasOwnProperty(types_1.CivicPassMessageAction.ISSUANCE));\n  logger_1.default.debug(\"reducer.action: \".concat(action.type), (0, status_1.statusDisplayValue)(updatedState.gatewayStatus));\n  switch (action.type) {\n    case 'startWalletPowo':\n      {\n        return Object.assign(Object.assign({}, updatedState), {\n          walletPowoInProgress: true\n        });\n      }\n    case 'walletPowoComplete':\n      {\n        logger_1.default.debug('tokenCreationInProgress', {\n          tokenCreationInProgress: tokenCreationInProgress\n        });\n        return Object.assign(Object.assign({}, updatedState), {\n          // only move to IN_REVIEW if it's during the initial token creation flow\n          gatewayStatus: tokenCreationInProgress ? types_1.GatewayStatus.IN_REVIEW : updatedState.gatewayStatus,\n          walletPowoInProgress: false,\n          firstTokenCheck: false\n        });\n      }\n    case 'walletPowoIncomplete':\n      {\n        logger_1.default.debug('tokenCreationInProgress', {\n          tokenCreationInProgress: tokenCreationInProgress\n        });\n        return Object.assign(Object.assign({}, state), {\n          renderIframe: false,\n          iframeMinimized: true,\n          powoFinished: false,\n          refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS\n        });\n      }\n    case 'tokenChange':\n      return Object.assign(Object.assign({}, state), {\n        gatewayStatus: (0, utils_1.statusFromToken)(state, action.token),\n        powoFinished: false,\n        gatewayToken: action.token,\n        tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED\n      });\n    case 'powoComplete':\n      return Object.assign(Object.assign({}, updatedState), {\n        gatewayStatus: types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP,\n        powoFinished: true,\n        powoRequested: undefined,\n        refreshTimeoutId: undefined,\n        refreshTokenState: state.refreshTokenState === types_1.RefreshTokenState.IN_PROGRESS ? types_1.RefreshTokenState.REQUIRES_POWO : state.refreshTokenState\n      });\n    case 'walletDisconnected':\n      return (0, utils_1.resetState)(state);\n    case 'requestGatekeeperIssuance':\n      return Object.assign(Object.assign({}, updatedState), {\n        powoFinished: false,\n        walletPowoInProgress: false,\n        tokenIssuanceState: types_1.TokenIssuanceState.IN_PROGRESS\n      });\n    case 'requestGatekeeperIssuanceComplete':\n      return Object.assign(Object.assign({}, updatedState), {\n        tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED,\n        gatewayTokenTransaction: action.gatewayTokenTransaction,\n        civicPass: Object.assign(Object.assign({}, updatedState.civicPass), {\n          responsePayload: undefined\n        })\n      });\n    case 'requestGatekeeperIssuanceFailed':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatewayStatus: types_1.GatewayStatus.ERROR,\n        tokenIssuanceState: types_1.TokenIssuanceState.FAILED\n      });\n    case 'refreshAttemptDone':\n      return Object.assign(Object.assign({}, updatedState), {\n        refreshInProgress: false\n      });\n    case 'updateStateWithProps':\n      return Object.assign(Object.assign({}, state), {\n        stage: action.stage,\n        walletAddress: action.walletAddress,\n        redirectUrl: action.redirectUrl,\n        gatekeeperNetworkAddress: action.gatekeeperNetworkAddress,\n        ownerSigns: action.ownerSigns\n      });\n    case 'tokenNotFoundError':\n      return Object.assign(Object.assign({}, state), {\n        renderIframe: false,\n        iframeMinimized: true,\n        gatewayStatus: types_1.GatewayStatus.ERROR\n      });\n    case 'gatekeeperNetworkChanged':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatekeeperNetworkAddress: action.gatekeeperNetworkAddress,\n        walletAddress: state.walletAddress\n      });\n    default:\n      return state;\n  }\n};\nexports.reducer = reducer;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","reducer","combineReducers","logger_1","require","types_1","utils_1","status_1","reducers","state","action","reduce","newState","_a","gatewayStatus","statusFromToken","gatewayToken","GatewayStatus","UNKNOWN","updatedState","assign","tokenCreationInProgress","civicPass","responsePayload","hasOwnProperty","CivicPassMessageAction","ISSUANCE","default","debug","type","statusDisplayValue","walletPowoInProgress","IN_REVIEW","firstTokenCheck","renderIframe","iframeMinimized","powoFinished","refreshTokenState","RefreshTokenState","IN_PROGRESS","token","tokenIssuanceState","TokenIssuanceState","COMPLETED","PROOF_OF_WALLET_OWNERSHIP","powoRequested","undefined","refreshTimeoutId","REQUIRES_POWO","resetState","gatewayTokenTransaction","ERROR","FAILED","refreshInProgress","stage","walletAddress","redirectUrl","gatekeeperNetworkAddress","ownerSigns"],"sources":["/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@civic/common-gateway-react/dist/esm/useReducer/reducer.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reducer = exports.combineReducers = void 0;\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst types_1 = require(\"../types\");\nconst utils_1 = require(\"./utils\");\nconst status_1 = require(\"../utils/status\");\nconst combineReducers = (...reducers) => (state, action) => reducers.reduce((newState, reducer) => reducer(newState, action), state);\nexports.combineReducers = combineReducers;\nconst reducer = (state, action) => {\n    var _a;\n    const gatewayStatus = (0, utils_1.statusFromToken)(state, state.gatewayToken) || types_1.GatewayStatus.UNKNOWN;\n    const updatedState = Object.assign(Object.assign({}, state), { gatewayStatus });\n    // eslint-disable-next-line no-prototype-builtins\n    const tokenCreationInProgress = !!((_a = updatedState.civicPass.responsePayload) === null || _a === void 0 ? void 0 : _a.hasOwnProperty(types_1.CivicPassMessageAction.ISSUANCE));\n    logger_1.default.debug(`reducer.action: ${action.type}`, (0, status_1.statusDisplayValue)(updatedState.gatewayStatus));\n    switch (action.type) {\n        case 'startWalletPowo': {\n            return Object.assign(Object.assign({}, updatedState), { walletPowoInProgress: true });\n        }\n        case 'walletPowoComplete': {\n            logger_1.default.debug('tokenCreationInProgress', { tokenCreationInProgress });\n            return Object.assign(Object.assign({}, updatedState), { \n                // only move to IN_REVIEW if it's during the initial token creation flow\n                gatewayStatus: tokenCreationInProgress ? types_1.GatewayStatus.IN_REVIEW : updatedState.gatewayStatus, walletPowoInProgress: false, firstTokenCheck: false });\n        }\n        case 'walletPowoIncomplete': {\n            logger_1.default.debug('tokenCreationInProgress', { tokenCreationInProgress });\n            return Object.assign(Object.assign({}, state), { renderIframe: false, iframeMinimized: true, powoFinished: false, refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS });\n        }\n        case 'tokenChange':\n            return Object.assign(Object.assign({}, state), { gatewayStatus: (0, utils_1.statusFromToken)(state, action.token), powoFinished: false, gatewayToken: action.token, tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED });\n        case 'powoComplete':\n            return Object.assign(Object.assign({}, updatedState), { gatewayStatus: types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP, powoFinished: true, powoRequested: undefined, refreshTimeoutId: undefined, refreshTokenState: state.refreshTokenState === types_1.RefreshTokenState.IN_PROGRESS\n                    ? types_1.RefreshTokenState.REQUIRES_POWO\n                    : state.refreshTokenState });\n        case 'walletDisconnected':\n            return (0, utils_1.resetState)(state);\n        case 'requestGatekeeperIssuance':\n            return Object.assign(Object.assign({}, updatedState), { powoFinished: false, walletPowoInProgress: false, tokenIssuanceState: types_1.TokenIssuanceState.IN_PROGRESS });\n        case 'requestGatekeeperIssuanceComplete':\n            return Object.assign(Object.assign({}, updatedState), { tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED, gatewayTokenTransaction: action.gatewayTokenTransaction, civicPass: Object.assign(Object.assign({}, updatedState.civicPass), { responsePayload: undefined }) });\n        case 'requestGatekeeperIssuanceFailed':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatewayStatus: types_1.GatewayStatus.ERROR, tokenIssuanceState: types_1.TokenIssuanceState.FAILED });\n        case 'refreshAttemptDone':\n            return Object.assign(Object.assign({}, updatedState), { refreshInProgress: false });\n        case 'updateStateWithProps':\n            return Object.assign(Object.assign({}, state), { stage: action.stage, walletAddress: action.walletAddress, redirectUrl: action.redirectUrl, gatekeeperNetworkAddress: action.gatekeeperNetworkAddress, ownerSigns: action.ownerSigns });\n        case 'tokenNotFoundError':\n            return Object.assign(Object.assign({}, state), { renderIframe: false, iframeMinimized: true, gatewayStatus: types_1.GatewayStatus.ERROR });\n        case 'gatekeeperNetworkChanged':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatekeeperNetworkAddress: action.gatekeeperNetworkAddress, walletAddress: state.walletAddress });\n        default:\n            return state;\n    }\n};\nexports.reducer = reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}