{"ast":null,"code":"\"use strict\";\n\nvar _defineProperty = require(\"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/defineProperty.js\").default;\nvar _regeneratorRuntime = require(\"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _asyncToGenerator = require(\"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar react_1 = require(\"react\");\nvar remoteSign_1 = require(\"../utils/remoteSign\");\nvar logger_1 = __importDefault(require(\"../logger\"));\nvar logDebug = function logDebug(message) {\n  var obj = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  return logger_1.default.debug(\"[useCivicPassEventListener] \".concat(message), obj);\n};\nvar logError = function logError(message) {\n  var obj = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  return logger_1.default.error(\"[useCivicPassEventListener] \".concat(message), obj);\n};\nvar useCivicPassEventListener = function useCivicPassEventListener(_ref) {\n  var wallet = _ref.wallet,\n    chainImplementation = _ref.chainImplementation,\n    remoteSign = _ref.remoteSign;\n  var dispatchEvent = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(response) {\n      var _events;\n      var remoteSigner, events, event;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (wallet) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 2:\n              remoteSigner = remoteSign !== null && remoteSign !== void 0 ? remoteSign : (0, remoteSign_1.remoteSignWindowEventEmitterImplementation)();\n              events = (_events = {}, _defineProperty(_events, remoteSign_1.CivicSignEventTypeRequest.REQUEST_PUBLIC_KEY, function () {\n                return new Promise(function (resolve) {\n                  remoteSigner === null || remoteSigner === void 0 ? void 0 : remoteSigner.sendPublicKey(wallet.publicKey);\n                  resolve();\n                });\n              }), _defineProperty(_events, remoteSign_1.CivicSignEventTypeRequest.REQUEST_DID, function () {\n                return new Promise(function (resolve) {\n                  remoteSigner === null || remoteSigner === void 0 ? void 0 : remoteSigner.sendDid(\"did:sol:\".concat(wallet.publicKey));\n                  resolve();\n                });\n              }), _defineProperty(_events, remoteSign_1.CivicSignEventTypeRequest.REQUEST_SIGNED_PROOF, _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n                var proof;\n                return _regeneratorRuntime().wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        _context.prev = 0;\n                        _context.next = 3;\n                        return chainImplementation.proveWalletOwnership();\n                      case 3:\n                        proof = _context.sent;\n                        remoteSigner === null || remoteSigner === void 0 ? void 0 : remoteSigner.sendSignedProof(proof);\n                        _context.next = 10;\n                        break;\n                      case 7:\n                        _context.prev = 7;\n                        _context.t0 = _context[\"catch\"](0);\n                        logError('Error signing proof', _context.t0);\n                      case 10:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee, null, [[0, 7]]);\n              }))), _events);\n              event = events[response];\n              if (!event) {\n                _context2.next = 9;\n                break;\n              }\n              _context2.next = 8;\n              return event();\n            case 8:\n              logDebug('Successfully emitted compliance event', response);\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return function dispatchEvent(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  /**\n   * Listen for post messages from the compliance iframe and dispatch events\n   * based on the event type\n   */\n  (0, react_1.useEffect)(function () {\n    var handler = /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(response) {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return dispatchEvent(response.data);\n              case 2:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n      return function handler(_x2) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n    window.addEventListener('message', handler);\n    return function () {\n      logDebug('Removing event listener for compliance');\n      return window.removeEventListener('message', handler);\n    };\n  }, []);\n  return {\n    dispatchEvent: dispatchEvent\n  };\n};\nexports.default = useCivicPassEventListener;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","react_1","require","remoteSign_1","logger_1","logDebug","message","obj","default","debug","logError","error","useCivicPassEventListener","wallet","chainImplementation","remoteSign","dispatchEvent","response","remoteSigner","remoteSignWindowEventEmitterImplementation","events","CivicSignEventTypeRequest","REQUEST_PUBLIC_KEY","Promise","resolve","sendPublicKey","publicKey","REQUEST_DID","sendDid","REQUEST_SIGNED_PROOF","proveWalletOwnership","proof","sendSignedProof","event","useEffect","handler","data","window","addEventListener","removeEventListener"],"sources":["/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@civic/common-gateway-react/dist/esm/useHooks/useCivicPassEventListener.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst react_1 = require(\"react\");\nconst remoteSign_1 = require(\"../utils/remoteSign\");\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst logDebug = (message, obj = null) => logger_1.default.debug(`[useCivicPassEventListener] ${message}`, obj);\nconst logError = (message, obj = null) => logger_1.default.error(`[useCivicPassEventListener] ${message}`, obj);\nconst useCivicPassEventListener = ({ wallet, chainImplementation, remoteSign, }) => {\n    const dispatchEvent = async (response) => {\n        if (!wallet)\n            return;\n        const remoteSigner = remoteSign !== null && remoteSign !== void 0 ? remoteSign : (0, remoteSign_1.remoteSignWindowEventEmitterImplementation)();\n        const events = {\n            [remoteSign_1.CivicSignEventTypeRequest.REQUEST_PUBLIC_KEY]: () => new Promise((resolve) => {\n                remoteSigner === null || remoteSigner === void 0 ? void 0 : remoteSigner.sendPublicKey(wallet.publicKey);\n                resolve();\n            }),\n            [remoteSign_1.CivicSignEventTypeRequest.REQUEST_DID]: () => new Promise((resolve) => {\n                remoteSigner === null || remoteSigner === void 0 ? void 0 : remoteSigner.sendDid(`did:sol:${wallet.publicKey}`);\n                resolve();\n            }),\n            [remoteSign_1.CivicSignEventTypeRequest.REQUEST_SIGNED_PROOF]: async () => {\n                try {\n                    const proof = await chainImplementation.proveWalletOwnership();\n                    remoteSigner === null || remoteSigner === void 0 ? void 0 : remoteSigner.sendSignedProof(proof);\n                }\n                catch (err) {\n                    logError('Error signing proof', err);\n                }\n            },\n        };\n        const event = events[response];\n        if (event) {\n            await event();\n            logDebug('Successfully emitted compliance event', response);\n        }\n    };\n    /**\n     * Listen for post messages from the compliance iframe and dispatch events\n     * based on the event type\n     */\n    (0, react_1.useEffect)(() => {\n        const handler = async (response) => {\n            await dispatchEvent(response.data);\n        };\n        window.addEventListener('message', handler);\n        return () => {\n            logDebug('Removing event listener for compliance');\n            return window.removeEventListener('message', handler);\n        };\n    }, []);\n    return { dispatchEvent };\n};\nexports.default = useCivicPassEventListener;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}