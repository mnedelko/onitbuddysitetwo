{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getTokenRefreshIntervalMilliseconds = exports.isTokenRefreshRequired = exports.hasExpired = void 0;\n/* eslint-disable import/prefer-default-export */\nvar logger_1 = __importDefault(require(\"../logger\"));\nvar types_1 = require(\"../types\");\nvar isApproachingExpiry = function isApproachingExpiry(currentExpiry, tokenExpirationMarginSeconds) {\n  var now = Math.floor(Date.now() / 1000);\n  logger_1.default.debug('checking if the token is approaching expiry', {\n    tokenExpirationMarginSeconds: tokenExpirationMarginSeconds,\n    currentExpiry: currentExpiry,\n    now: now,\n    approachingExpiryResult: currentExpiry - now < tokenExpirationMarginSeconds\n  });\n  return currentExpiry - now < tokenExpirationMarginSeconds;\n};\nvar hasExpired = function hasExpired(expiryTime) {\n  if (!expiryTime) return false;\n  var now = Math.floor(Date.now() / 1000);\n  return now >= expiryTime;\n};\nexports.hasExpired = hasExpired;\nvar isTokenRefreshRequired = function isTokenRefreshRequired(_ref) {\n  var gatewayToken = _ref.gatewayToken,\n    tokenExpirationMarginSeconds = _ref.tokenExpirationMarginSeconds;\n  var expiryTime = gatewayToken.expiryTime,\n    state = gatewayToken.state;\n  var isActive = state === types_1.State.ACTIVE;\n  if (!expiryTime || !isActive) return false;\n  return (0, exports.hasExpired)(expiryTime) || isApproachingExpiry(expiryTime, tokenExpirationMarginSeconds);\n};\nexports.isTokenRefreshRequired = isTokenRefreshRequired;\nvar getTokenRefreshIntervalMilliseconds = function getTokenRefreshIntervalMilliseconds(expiryTime, tokenExpirationMarginSeconds) {\n  var now = Math.floor(Date.now() / 1000);\n  var interval = expiryTime - now - tokenExpirationMarginSeconds;\n  return interval > 0 ? interval * 1000 : 0;\n};\nexports.getTokenRefreshIntervalMilliseconds = getTokenRefreshIntervalMilliseconds;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","getTokenRefreshIntervalMilliseconds","isTokenRefreshRequired","hasExpired","logger_1","require","types_1","isApproachingExpiry","currentExpiry","tokenExpirationMarginSeconds","now","Math","floor","Date","default","debug","approachingExpiryResult","expiryTime","gatewayToken","state","isActive","State","ACTIVE","interval"],"sources":["/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@civic/common-gateway-react/dist/esm/utils/tokenUtils.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getTokenRefreshIntervalMilliseconds = exports.isTokenRefreshRequired = exports.hasExpired = void 0;\n/* eslint-disable import/prefer-default-export */\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst types_1 = require(\"../types\");\nconst isApproachingExpiry = (currentExpiry, tokenExpirationMarginSeconds) => {\n    const now = Math.floor(Date.now() / 1000);\n    logger_1.default.debug('checking if the token is approaching expiry', {\n        tokenExpirationMarginSeconds,\n        currentExpiry,\n        now,\n        approachingExpiryResult: currentExpiry - now < tokenExpirationMarginSeconds,\n    });\n    return currentExpiry - now < tokenExpirationMarginSeconds;\n};\nconst hasExpired = (expiryTime) => {\n    if (!expiryTime)\n        return false;\n    const now = Math.floor(Date.now() / 1000);\n    return now >= expiryTime;\n};\nexports.hasExpired = hasExpired;\nconst isTokenRefreshRequired = ({ gatewayToken, tokenExpirationMarginSeconds, }) => {\n    const { expiryTime, state } = gatewayToken;\n    const isActive = state === types_1.State.ACTIVE;\n    if (!expiryTime || !isActive)\n        return false;\n    return (0, exports.hasExpired)(expiryTime) || isApproachingExpiry(expiryTime, tokenExpirationMarginSeconds);\n};\nexports.isTokenRefreshRequired = isTokenRefreshRequired;\nconst getTokenRefreshIntervalMilliseconds = (expiryTime, tokenExpirationMarginSeconds) => {\n    const now = Math.floor(Date.now() / 1000);\n    const interval = expiryTime - now - tokenExpirationMarginSeconds;\n    return interval > 0 ? interval * 1000 : 0;\n};\nexports.getTokenRefreshIntervalMilliseconds = getTokenRefreshIntervalMilliseconds;\n"],"mappings":"AAAA,YAAY;;AACZ,IAAIA,eAAe,GAAI,IAAI,IAAI,IAAI,CAACA,eAAe,IAAK,UAAUC,GAAG,EAAE;EACnE,OAAQA,GAAG,IAAIA,GAAG,CAACC,UAAU,GAAID,GAAG,GAAG;IAAE,SAAS,EAAEA;EAAI,CAAC;AAC7D,CAAC;AACDE,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,mCAAmC,GAAGF,OAAO,CAACG,sBAAsB,GAAGH,OAAO,CAACI,UAAU,GAAG,KAAK,CAAC;AAC1G;AACA,IAAMC,QAAQ,GAAGV,eAAe,CAACW,OAAO,CAAC,WAAW,CAAC,CAAC;AACtD,IAAMC,OAAO,GAAGD,OAAO,CAAC,UAAU,CAAC;AACnC,IAAME,mBAAmB,GAAG,SAAtBA,mBAAmB,CAAIC,aAAa,EAAEC,4BAA4B,EAAK;EACzE,IAAMC,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACH,GAAG,EAAE,GAAG,IAAI,CAAC;EACzCN,QAAQ,CAACU,OAAO,CAACC,KAAK,CAAC,6CAA6C,EAAE;IAClEN,4BAA4B,EAA5BA,4BAA4B;IAC5BD,aAAa,EAAbA,aAAa;IACbE,GAAG,EAAHA,GAAG;IACHM,uBAAuB,EAAER,aAAa,GAAGE,GAAG,GAAGD;EACnD,CAAC,CAAC;EACF,OAAOD,aAAa,GAAGE,GAAG,GAAGD,4BAA4B;AAC7D,CAAC;AACD,IAAMN,UAAU,GAAG,SAAbA,UAAU,CAAIc,UAAU,EAAK;EAC/B,IAAI,CAACA,UAAU,EACX,OAAO,KAAK;EAChB,IAAMP,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACH,GAAG,EAAE,GAAG,IAAI,CAAC;EACzC,OAAOA,GAAG,IAAIO,UAAU;AAC5B,CAAC;AACDlB,OAAO,CAACI,UAAU,GAAGA,UAAU;AAC/B,IAAMD,sBAAsB,GAAG,SAAzBA,sBAAsB,OAAwD;EAAA,IAAlDgB,YAAY,QAAZA,YAAY;IAAET,4BAA4B,QAA5BA,4BAA4B;EACxE,IAAQQ,UAAU,GAAYC,YAAY,CAAlCD,UAAU;IAAEE,KAAK,GAAKD,YAAY,CAAtBC,KAAK;EACzB,IAAMC,QAAQ,GAAGD,KAAK,KAAKb,OAAO,CAACe,KAAK,CAACC,MAAM;EAC/C,IAAI,CAACL,UAAU,IAAI,CAACG,QAAQ,EACxB,OAAO,KAAK;EAChB,OAAO,CAAC,CAAC,EAAErB,OAAO,CAACI,UAAU,EAAEc,UAAU,CAAC,IAAIV,mBAAmB,CAACU,UAAU,EAAER,4BAA4B,CAAC;AAC/G,CAAC;AACDV,OAAO,CAACG,sBAAsB,GAAGA,sBAAsB;AACvD,IAAMD,mCAAmC,GAAG,SAAtCA,mCAAmC,CAAIgB,UAAU,EAAER,4BAA4B,EAAK;EACtF,IAAMC,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACH,GAAG,EAAE,GAAG,IAAI,CAAC;EACzC,IAAMa,QAAQ,GAAGN,UAAU,GAAGP,GAAG,GAAGD,4BAA4B;EAChE,OAAOc,QAAQ,GAAG,CAAC,GAAGA,QAAQ,GAAG,IAAI,GAAG,CAAC;AAC7C,CAAC;AACDxB,OAAO,CAACE,mCAAmC,GAAGA,mCAAmC"},"metadata":{},"sourceType":"script"}