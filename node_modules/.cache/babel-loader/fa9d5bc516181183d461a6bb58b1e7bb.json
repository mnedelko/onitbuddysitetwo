{"ast":null,"code":"import _defineProperty2 from \"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _assertThisInitialized from \"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _slicedToArray from \"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _regeneratorRuntime from \"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _classCallCheck from \"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _asyncToGenerator from \"/Users/mnedelko/Library/Mobile Documents/com~apple~CloudDocs/Documents/comparativesite/onitbuddyprod/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport loglevel from 'loglevel';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { getPublic, sign, encrypt as _encrypt, decrypt as _decrypt } from '@toruslabs/eccrypto';\nimport { get } from '@toruslabs/http-helpers';\nimport { setupMultiplex, PostMessageStream, SafeEventEmitter, createStreamMiddleware, JRPCEngine, createIdRemapMiddleware, getRpcPromiseCallback } from '@toruslabs/openlogin-jrpc';\nimport { base64url, keccak, safeatob, randomId, jsonToBase64 } from '@toruslabs/openlogin-utils';\nimport merge from 'lodash.merge';\nimport pump from 'pump';\nvar modalDOMElementID = \"openlogin-modal\";\nvar storeKey = \"openlogin_store\";\nvar UX_MODE = {\n  POPUP: \"popup\",\n  REDIRECT: \"redirect\"\n};\nvar OPENLOGIN_METHOD = {\n  LOGIN: \"openlogin_login\",\n  LOGOUT: \"openlogin_logout\",\n  CHECK_3PC_SUPPORT: \"openlogin_check_3PC_support\",\n  SET_PID_DATA: \"openlogin_set_pid_data\",\n  GET_DATA: \"openlogin_get_data\"\n};\nvar ALLOWED_INTERACTIONS = {\n  POPUP: \"popup\",\n  REDIRECT: \"redirect\",\n  JRPC: \"jrpc\"\n};\nvar OPENLOGIN_NETWORK = {\n  MAINNET: \"mainnet\",\n  TESTNET: \"testnet\",\n  CYAN: \"cyan\",\n  DEVELOPMENT: \"development\"\n};\nvar LOGIN_PROVIDER = {\n  GOOGLE: \"google\",\n  FACEBOOK: \"facebook\",\n  REDDIT: \"reddit\",\n  DISCORD: \"discord\",\n  TWITCH: \"twitch\",\n  APPLE: \"apple\",\n  LINE: \"line\",\n  GITHUB: \"github\",\n  KAKAO: \"kakao\",\n  LINKEDIN: \"linkedin\",\n  TWITTER: \"twitter\",\n  WEIBO: \"weibo\",\n  WECHAT: \"wechat\",\n  EMAIL_PASSWORDLESS: \"email_passwordless\",\n  WEBAUTHN: \"webauthn\",\n  JWT: \"jwt\"\n};\nvar MFA_LEVELS = {\n  DEFAULT: \"default\",\n  OPTIONAL: \"optional\",\n  MANDATORY: \"mandatory\",\n  NONE: \"none\"\n};\nloglevel.setLevel(\"error\");\nvar log = loglevel.getLogger(\"openlogin\");\nfunction documentReady() {\n  return _documentReady.apply(this, arguments);\n}\nfunction _documentReady() {\n  _documentReady = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee25() {\n    return _regeneratorRuntime().wrap(function _callee25$(_context25) {\n      while (1) {\n        switch (_context25.prev = _context25.next) {\n          case 0:\n            return _context25.abrupt(\"return\", new Promise(function (resolve) {\n              if (document.readyState !== \"loading\") {\n                resolve();\n              } else {\n                document.addEventListener(\"DOMContentLoaded\", function () {\n                  resolve();\n                });\n              }\n            }));\n          case 1:\n          case \"end\":\n            return _context25.stop();\n        }\n      }\n    }, _callee25);\n  }));\n  return _documentReady.apply(this, arguments);\n}\nvar htmlToElement = function htmlToElement(html) {\n  var template = window.document.createElement(\"template\");\n  var trimmedHtml = html.trim(); // Never return a text node of whitespace as the result\n\n  template.innerHTML = trimmedHtml;\n  return template.content.firstChild;\n};\nfunction whitelistUrl(_x, _x2, _x3) {\n  return _whitelistUrl.apply(this, arguments);\n}\nfunction _whitelistUrl() {\n  _whitelistUrl = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee26(clientId, appKey, origin) {\n    var appKeyBuf, sig;\n    return _regeneratorRuntime().wrap(function _callee26$(_context26) {\n      while (1) {\n        switch (_context26.prev = _context26.next) {\n          case 0:\n            appKeyBuf = Buffer.from(appKey.padStart(64, \"0\"), \"hex\");\n            if (!(base64url.encode(getPublic(appKeyBuf)) !== clientId)) {\n              _context26.next = 3;\n              break;\n            }\n            throw new Error(\"appKey mismatch\");\n          case 3:\n            _context26.next = 5;\n            return sign(appKeyBuf, Buffer.from(keccak(\"keccak256\").update(origin).digest(\"hex\"), \"hex\"));\n          case 5:\n            sig = _context26.sent;\n            return _context26.abrupt(\"return\", base64url.encode(sig));\n          case 7:\n          case \"end\":\n            return _context26.stop();\n        }\n      }\n    }, _callee26);\n  }));\n  return _whitelistUrl.apply(this, arguments);\n}\nfunction getHashQueryParams() {\n  var replaceUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n  var result = {};\n  var url = new URL(window.location.href);\n  url.searchParams.forEach(function (value, key) {\n    if (key !== \"result\") {\n      result[key] = value;\n    }\n  });\n  var queryResult = url.searchParams.get(\"result\");\n  if (queryResult) {\n    try {\n      var queryParams = JSON.parse(safeatob(queryResult));\n      Object.keys(queryParams).forEach(function (key) {\n        result[key] = queryParams[key];\n      });\n    } catch (error) {\n      log.error(error);\n    }\n  }\n  var hash = url.hash.substring(1);\n  var hashUrl = new URL(\"\".concat(window.location.origin, \"/?\").concat(hash));\n  hashUrl.searchParams.forEach(function (value, key) {\n    if (key !== \"result\") {\n      result[key] = value;\n    }\n  });\n  var hashResult = hashUrl.searchParams.get(\"result\");\n  if (hashResult) {\n    try {\n      var hashParams = JSON.parse(safeatob(hashResult));\n      Object.keys(hashParams).forEach(function (key) {\n        result[key] = hashParams[key];\n      });\n    } catch (error) {\n      log.error(error);\n    }\n  }\n  if (replaceUrl) {\n    var cleanUrl = window.location.origin + window.location.pathname;\n    window.history.replaceState(null, \"\", cleanUrl);\n  }\n  return result;\n}\nfunction awaitReq(id, windowRef) {\n  return new Promise(function (resolve, reject) {\n    if (!windowRef) reject(new Error(\"Unable to open window\"));\n    var closedByHandler = false;\n    var closedMonitor = setInterval(function () {\n      if (!closedByHandler && windowRef.closed) {\n        clearInterval(closedMonitor);\n        reject(new Error(\"user closed popup\"));\n      }\n    }, 500);\n    var handler = function handler(ev) {\n      var pid = ev.data.pid;\n      if (id !== pid) return;\n      window.removeEventListener(\"message\", handler);\n      closedByHandler = true;\n      clearInterval(closedMonitor);\n      windowRef.close();\n      if (ev.data.data && ev.data.data.error) {\n        reject(new Error(ev.data.data.error));\n      } else {\n        resolve(ev.data.data);\n      }\n    };\n    window.addEventListener(\"message\", handler);\n  });\n}\nfunction constructURL(params) {\n  var baseURL = params.baseURL,\n    query = params.query,\n    hash = params.hash;\n  var url = new URL(baseURL);\n  if (query) {\n    Object.keys(query).forEach(function (key) {\n      url.searchParams.append(key, query[key]);\n    });\n  }\n  if (hash) {\n    var h = new URL(constructURL({\n      baseURL: baseURL,\n      query: hash\n    })).searchParams.toString();\n    url.hash = h;\n  }\n  return url.toString();\n}\nfunction storageAvailable(type) {\n  var storageExists = false;\n  var storageLength = 0;\n  var storage;\n  try {\n    storage = window[type];\n    storageExists = true;\n    storageLength = storage.length;\n    var x = \"__storage_test__\";\n    storage.setItem(x, x);\n    storage.removeItem(x);\n    return true;\n  } catch (error) {\n    return error && (\n    // everything except Firefox\n    error.code === 22 ||\n    // Firefox\n    error.code === 1014 ||\n    // test name field too, because code might not be present\n    // everything except Firefox\n    error.name === \"QuotaExceededErro r\" ||\n    // Firefox\n    error.name === \"NS_ERROR_DOM_QUOTA_REACHED\") &&\n    // acknowledge QuotaExceededError only if there's something already stored\n    storageExists && storageLength !== 0;\n  }\n}\nvar sessionStorageAvailable = storageAvailable(\"sessionStorage\");\nvar localStorageAvailable = storageAvailable(\"localStorage\");\nfunction preloadIframe(url) {\n  try {\n    if (typeof document === \"undefined\") return;\n    var openloginIframeHtml = document.createElement(\"link\");\n    openloginIframeHtml.href = url;\n    openloginIframeHtml.crossOrigin = \"anonymous\";\n    openloginIframeHtml.type = \"text/html\";\n    openloginIframeHtml.rel = \"prefetch\";\n    if (openloginIframeHtml.relList && openloginIframeHtml.relList.supports) {\n      if (openloginIframeHtml.relList.supports(\"prefetch\")) {\n        document.head.appendChild(openloginIframeHtml);\n      }\n    }\n  } catch (error) {\n    log.error(error);\n  }\n}\nfunction getPopupFeatures() {\n  // Fixes dual-screen position                             Most browsers      Firefox\n  var dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;\n  var dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;\n  var w = 1200;\n  var h = 700;\n  var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : window.screen.width;\n  var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : window.screen.height;\n  var systemZoom = 1; // No reliable estimate\n\n  var left = Math.abs((width - w) / 2 / systemZoom + dualScreenLeft);\n  var top = Math.abs((height - h) / 2 / systemZoom + dualScreenTop);\n  var features = \"titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=\".concat(h / systemZoom, \",width=\").concat(w / systemZoom, \",top=\").concat(top, \",left=\").concat(left);\n  return features;\n}\nvar handleStream = function handleStream(handle, eventName, handler) {\n  var handlerWrapper = function handlerWrapper(chunk) {\n    handler(chunk);\n    handle.removeListener(eventName, handlerWrapper);\n  };\n  handle.on(eventName, handlerWrapper);\n};\nvar Modal = /*#__PURE__*/function () {\n  function Modal(modalUrl) {\n    _classCallCheck(this, Modal);\n    _defineProperty(this, \"modalUrl\", void 0);\n    _defineProperty(this, \"iframeElem\", void 0);\n    _defineProperty(this, \"initialized\", false);\n    _defineProperty(this, \"modalZIndex\", 99999);\n    _defineProperty(this, \"mux\", void 0);\n    _defineProperty(this, \"verifierStream\", void 0);\n    this.modalUrl = modalUrl;\n  }\n  _createClass(Modal, [{\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.initIFrame(this.modalUrl);\n              case 2:\n                this.setupStream();\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n      function init() {\n        return _init.apply(this, arguments);\n      }\n      return init;\n    }()\n  }, {\n    key: \"setupStream\",\n    value: function setupStream() {\n      if (this.iframeElem === null) throw new Error(\"iframe is null\");\n      this.mux = setupMultiplex(new PostMessageStream({\n        name: \"modal_iframe_rpc\",\n        target: \"modal_rpc\",\n        targetWindow: this.iframeElem.contentWindow,\n        targetOrigin: new URL(this.modalUrl).origin\n      }));\n      this.verifierStream = this.mux.createStream(\"verifier\");\n    }\n  }, {\n    key: \"initIFrame\",\n    value: function () {\n      var _initIFrame = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(src) {\n        var _this = this;\n        var documentIFrameElem;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return documentReady();\n              case 2:\n                documentIFrameElem = document.getElementById(modalDOMElementID);\n                if (documentIFrameElem) {\n                  documentIFrameElem.remove();\n                  log.info(\"already initialized, removing previous modal iframe\");\n                }\n                this.iframeElem = htmlToElement(\"<iframe\\n        id=\".concat(modalDOMElementID, \"\\n        class=\\\"torusIframe\\\"\\n        src=\\\"\").concat(src, \"\\\"\\n        style=\\\"display: none; position: fixed; top: 0; right: 0; width: 100%;\\n        height: 100%; border: none; border-radius: 0; z-index: \").concat(this.modalZIndex.toString(), \"\\\"\\n      ></iframe>\"));\n                this._hideModal();\n                document.body.appendChild(this.iframeElem);\n                return _context2.abrupt(\"return\", new Promise(function (resolve) {\n                  _this.iframeElem.onload = function () {\n                    _this.initialized = true;\n                    resolve();\n                  };\n                }));\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n      function initIFrame(_x4) {\n        return _initIFrame.apply(this, arguments);\n      }\n      return initIFrame;\n    }()\n  }, {\n    key: \"_showModal\",\n    value: function _showModal() {\n      var style = {};\n      style.display = \"block\";\n      style.position = \"fixed\";\n      style.width = \"100%\";\n      style.height = \"100%\";\n      style.top = \"0px\";\n      style.right = \"0px\";\n      style.left = \"0px\";\n      style.bottom = \"0px\";\n      style.border = \"0\";\n      style[\"z-index\"] = this.modalZIndex;\n      this.iframeElem.setAttribute(\"style\", Object.entries(style).map(function (_ref) {\n        var _ref3 = _slicedToArray(_ref, 2),\n          k = _ref3[0],\n          v = _ref3[1];\n        return \"\".concat(k, \":\").concat(v);\n      }).join(\";\"));\n    }\n  }, {\n    key: \"_hideModal\",\n    value: function _hideModal() {\n      var style = {};\n      style.display = \"none\";\n      style.position = \"fixed\";\n      style.width = \"100%\";\n      style.height = \"100%\";\n      style.top = \"0px\";\n      style.right = \"0px\";\n      style.left = \"0px\";\n      style.bottom = \"0px\";\n      style.border = \"0\";\n      style[\"z-index\"] = this.modalZIndex;\n      this.iframeElem.setAttribute(\"style\", Object.entries(style).map(function (_ref2) {\n        var _ref4 = _slicedToArray(_ref2, 2),\n          k = _ref4[0],\n          v = _ref4[1];\n        return \"\".concat(k, \":\").concat(v);\n      }).join(\";\"));\n    }\n  }, {\n    key: \"_prompt\",\n    value: function () {\n      var _prompt2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(clientId, whiteLabel, loginConfig, cb) {\n        var _this2 = this;\n        var modalHandler;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this._showModal();\n                modalHandler = function modalHandler(chunk) {\n                  _this2._hideModal();\n                  cb(chunk);\n                };\n                handleStream(this.verifierStream, \"data\", modalHandler);\n                this.verifierStream.write({\n                  name: \"prompt\",\n                  clientId: clientId,\n                  whiteLabel: whiteLabel,\n                  loginConfig: loginConfig\n                });\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n      function _prompt(_x5, _x6, _x7, _x8) {\n        return _prompt2.apply(this, arguments);\n      }\n      return _prompt;\n    }()\n  }, {\n    key: \"cleanup\",\n    value: function () {\n      var _cleanup = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var documentIFrameElem;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return documentReady();\n              case 2:\n                documentIFrameElem = document.getElementById(modalDOMElementID);\n                if (documentIFrameElem) {\n                  documentIFrameElem.remove();\n                  this.iframeElem = null;\n                }\n                this.initialized = false;\n              case 5:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n      function cleanup() {\n        return _cleanup.apply(this, arguments);\n      }\n      return cleanup;\n    }()\n  }]);\n  return Modal;\n}();\nvar MemoryStore = /*#__PURE__*/function () {\n  function MemoryStore() {\n    _classCallCheck(this, MemoryStore);\n    _defineProperty(this, \"store\", {});\n  }\n  _createClass(MemoryStore, [{\n    key: \"getItem\",\n    value: function getItem(key) {\n      return this.store[key];\n    }\n  }, {\n    key: \"setItem\",\n    value: function setItem(key, value) {\n      this.store[key] = value;\n    }\n  }]);\n  return MemoryStore;\n}();\nvar OpenLoginStore = /*#__PURE__*/function () {\n  // eslint-disable-next-line no-use-before-define\n  function OpenLoginStore(storage) {\n    _classCallCheck(this, OpenLoginStore);\n    _defineProperty(this, \"storage\", void 0);\n    this.storage = storage;\n    try {\n      if (!storage.getItem(storeKey)) {\n        this.resetStore();\n      }\n    } catch (error) {// Storage is not available\n    }\n  }\n  _createClass(OpenLoginStore, [{\n    key: \"toJSON\",\n    value: function toJSON() {\n      return this.storage.getItem(storeKey);\n    }\n  }, {\n    key: \"resetStore\",\n    value: function resetStore() {\n      var currStore = this.getStore();\n      this.storage.setItem(storeKey, JSON.stringify({}));\n      return currStore;\n    }\n  }, {\n    key: \"getStore\",\n    value: function getStore() {\n      return JSON.parse(this.storage.getItem(storeKey));\n    }\n  }, {\n    key: \"get\",\n    value: function get(key) {\n      var store = JSON.parse(this.storage.getItem(storeKey));\n      return store[key];\n    }\n  }, {\n    key: \"set\",\n    value: function set(key, value) {\n      var store = JSON.parse(this.storage.getItem(storeKey));\n      store[key] = value;\n      this.storage.setItem(storeKey, JSON.stringify(store));\n    }\n  }], [{\n    key: \"getInstance\",\n    value: function getInstance() {\n      if (!this.instance) {\n        this.instance = new this(localStorageAvailable ? localStorage : new MemoryStore());\n      }\n      return this.instance;\n    }\n  }]);\n  return OpenLoginStore;\n}();\n_defineProperty(OpenLoginStore, \"instance\", void 0);\nvar Provider = /*#__PURE__*/function (_SafeEventEmitter) {\n  _inherits(Provider, _SafeEventEmitter);\n  var _super = _createSuper(Provider);\n  function Provider() {\n    var _this3;\n    _classCallCheck(this, Provider);\n    _this3 = _super.apply(this, arguments);\n    _defineProperty(_assertThisInitialized(_this3), \"iframeElem\", null);\n    _defineProperty(_assertThisInitialized(_this3), \"rpcStream\", void 0);\n    _defineProperty(_assertThisInitialized(_this3), \"iframeUrl\", void 0);\n    _defineProperty(_assertThisInitialized(_this3), \"rpcEngine\", void 0);\n    _defineProperty(_assertThisInitialized(_this3), \"initialized\", void 0);\n    _defineProperty(_assertThisInitialized(_this3), \"mux\", void 0);\n    return _this3;\n  }\n  _createClass(Provider, [{\n    key: \"init\",\n    value: function init(_ref) {\n      var iframeElem = _ref.iframeElem,\n        iframeUrl = _ref.iframeUrl;\n      this.iframeElem = iframeElem;\n      this.iframeUrl = iframeUrl;\n      this.setupStream();\n      this.initialized = true;\n    }\n  }, {\n    key: \"setupStream\",\n    value: function setupStream() {\n      if (this.iframeElem === null) throw new Error(\"iframe is null\");\n      this.rpcStream = new PostMessageStream({\n        name: \"embed_rpc\",\n        target: \"iframe_rpc\",\n        targetWindow: this.iframeElem.contentWindow,\n        targetOrigin: new URL(this.iframeUrl).origin\n      });\n      this.mux = setupMultiplex(this.rpcStream);\n      var JRPCConnection = createStreamMiddleware();\n      pump(JRPCConnection.stream, this.mux.createStream(\"jrpc\"), JRPCConnection.stream, function (error) {\n        log.error(\"JRPC connection broken\", error);\n      });\n      var rpcEngine = new JRPCEngine();\n      rpcEngine.push(createIdRemapMiddleware());\n      rpcEngine.push(JRPCConnection.middleware);\n      this.rpcEngine = rpcEngine;\n    }\n  }, {\n    key: \"cleanup\",\n    value: function cleanup() {\n      this.iframeElem = null;\n      this.initialized = false;\n    }\n  }, {\n    key: \"_rpcRequest\",\n    value: function _rpcRequest(payload, callback) {\n      if (!payload.jsonrpc) {\n        payload.jsonrpc = \"2.0\";\n      }\n      if (!payload.id) {\n        payload.id = randomId();\n      }\n      this.rpcEngine.handle(payload, callback);\n    }\n  }]);\n  return Provider;\n}(SafeEventEmitter);\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\npreloadIframe(\"https://app.openlogin.com/sdk-modal\");\nvar OpenLogin = /*#__PURE__*/function () {\n  function OpenLogin(options) {\n    _classCallCheck(this, OpenLogin);\n    var _options$no3PC, _options$_startUrl, _options$_popupUrl, _options$redirectUrl, _options$uxMode, _options$replaceUrlOn, _options$originData, _options$whiteLabel, _options$loginConfig;\n    _defineProperty(this, \"provider\", void 0);\n    _defineProperty(this, \"state\", void 0);\n    _defineProperty(this, \"modal\", void 0);\n    this.provider = new Proxy(new Provider(), {\n      deleteProperty: function deleteProperty() {\n        return true;\n      } // work around for web3\n    });\n\n    if (!options._iframeUrl) {\n      if (options.network === OPENLOGIN_NETWORK.MAINNET) {\n        options._iframeUrl = \"https://app.openlogin.com\";\n      } else if (options.network === OPENLOGIN_NETWORK.CYAN) {\n        options._iframeUrl = \"https://cyan.openlogin.com\";\n      } else if (options.network === OPENLOGIN_NETWORK.TESTNET) {\n        options._iframeUrl = \"https://beta.openlogin.com\";\n      } else if (options.network === OPENLOGIN_NETWORK.DEVELOPMENT) {\n        options._iframeUrl = \"http://localhost:3000\";\n      }\n    }\n    if (!options._iframeUrl) {\n      throw new Error(\"unspecified network and iframeUrl\");\n    }\n    this.modal = new Modal(\"\".concat(options._iframeUrl, \"/sdk-modal\"));\n    this.initState(_objectSpread(_objectSpread({}, options), {}, {\n      no3PC: (_options$no3PC = options.no3PC) !== null && _options$no3PC !== void 0 ? _options$no3PC : false,\n      _iframeUrl: options._iframeUrl,\n      _startUrl: (_options$_startUrl = options._startUrl) !== null && _options$_startUrl !== void 0 ? _options$_startUrl : \"\".concat(options._iframeUrl, \"/start\"),\n      _popupUrl: (_options$_popupUrl = options._popupUrl) !== null && _options$_popupUrl !== void 0 ? _options$_popupUrl : \"\".concat(options._iframeUrl, \"/popup-window\"),\n      redirectUrl: (_options$redirectUrl = options.redirectUrl) !== null && _options$redirectUrl !== void 0 ? _options$redirectUrl : \"\".concat(window.location.protocol, \"//\").concat(window.location.host).concat(window.location.pathname),\n      uxMode: (_options$uxMode = options.uxMode) !== null && _options$uxMode !== void 0 ? _options$uxMode : UX_MODE.REDIRECT,\n      replaceUrlOnRedirect: (_options$replaceUrlOn = options.replaceUrlOnRedirect) !== null && _options$replaceUrlOn !== void 0 ? _options$replaceUrlOn : true,\n      originData: (_options$originData = options.originData) !== null && _options$originData !== void 0 ? _options$originData : _defineProperty2({}, window.location.origin, \"\"),\n      whiteLabel: (_options$whiteLabel = options.whiteLabel) !== null && _options$whiteLabel !== void 0 ? _options$whiteLabel : {},\n      loginConfig: (_options$loginConfig = options.loginConfig) !== null && _options$loginConfig !== void 0 ? _options$loginConfig : {}\n    }));\n  }\n  _createClass(OpenLogin, [{\n    key: \"privKey\",\n    get: function get() {\n      return this.state.privKey ? this.state.privKey.padStart(64, \"0\") : \"\";\n    }\n  }, {\n    key: \"initState\",\n    value: function initState(options) {\n      this.state = {\n        uxMode: options.uxMode,\n        network: options.network,\n        store: OpenLoginStore.getInstance(),\n        iframeUrl: options._iframeUrl,\n        startUrl: options._startUrl,\n        popupUrl: options._popupUrl,\n        clientId: options.clientId,\n        redirectUrl: options.redirectUrl,\n        replaceUrlOnRedirect: options.replaceUrlOnRedirect,\n        originData: options.originData,\n        loginConfig: options.loginConfig,\n        support3PC: !options.no3PC,\n        whiteLabel: options.whiteLabel\n      };\n    }\n  }, {\n    key: \"init\",\n    value: function () {\n      var _init2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var res;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (!this.state.support3PC) {\n                  _context5.next = 16;\n                  break;\n                }\n                _context5.next = 3;\n                return Promise.all([this.modal.init(), this.updateOriginData()]);\n              case 3:\n                this.provider.init({\n                  iframeElem: this.modal.iframeElem,\n                  iframeUrl: this.state.iframeUrl\n                });\n                _context5.t0 = this;\n                _context5.next = 7;\n                return this._getData();\n              case 7:\n                _context5.t1 = _context5.sent;\n                _context5.t0._syncState.call(_context5.t0, _context5.t1);\n                this._syncState(getHashQueryParams(this.state.replaceUrlOnRedirect));\n                _context5.next = 12;\n                return this._check3PCSupport();\n              case 12:\n                res = _context5.sent;\n                this.state.support3PC = !!res.support3PC;\n                _context5.next = 19;\n                break;\n              case 16:\n                _context5.next = 18;\n                return this.updateOriginData();\n              case 18:\n                this._syncState(getHashQueryParams(this.state.replaceUrlOnRedirect));\n              case 19:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n      function init() {\n        return _init2.apply(this, arguments);\n      }\n      return init;\n    }()\n  }, {\n    key: \"updateOriginData\",\n    value: function () {\n      var _updateOriginData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        var filteredOriginData, _yield$Promise$all, _yield$Promise$all2, whitelist, whiteLabel;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                filteredOriginData = JSON.parse(JSON.stringify(this.state.originData));\n                Object.keys(filteredOriginData).forEach(function (key) {\n                  if (filteredOriginData[key] === \"\") delete filteredOriginData[key];\n                });\n                _context6.next = 4;\n                return Promise.all([this.getWhitelist(), this.getWhiteLabel()]);\n              case 4:\n                _yield$Promise$all = _context6.sent;\n                _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 2);\n                whitelist = _yield$Promise$all2[0];\n                whiteLabel = _yield$Promise$all2[1];\n                this._syncState({\n                  originData: _objectSpread(_objectSpread({}, whitelist), filteredOriginData),\n                  whiteLabel: _objectSpread(_objectSpread({}, whiteLabel), this.state.whiteLabel)\n                });\n              case 9:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n      function updateOriginData() {\n        return _updateOriginData.apply(this, arguments);\n      }\n      return updateOriginData;\n    }()\n  }, {\n    key: \"getWhitelist\",\n    value: function () {\n      var _getWhitelist = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        var clientId, url, res;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.prev = 0;\n                clientId = this.state.clientId;\n                if (clientId) {\n                  _context7.next = 4;\n                  break;\n                }\n                throw new Error(\"unspecified clientId\");\n              case 4:\n                url = new URL(\"https://api.developer.tor.us/whitelist\");\n                url.searchParams.append(\"project_id\", this.state.clientId);\n                _context7.next = 8;\n                return get(url.href);\n              case 8:\n                res = _context7.sent;\n                return _context7.abrupt(\"return\", res.signed_urls);\n              case 12:\n                _context7.prev = 12;\n                _context7.t0 = _context7[\"catch\"](0);\n                return _context7.abrupt(\"return\", {});\n              case 15:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this, [[0, 12]]);\n      }));\n      function getWhitelist() {\n        return _getWhitelist.apply(this, arguments);\n      }\n      return getWhitelist;\n    }()\n  }, {\n    key: \"getWhiteLabel\",\n    value: function () {\n      var _getWhiteLabel = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n        var clientId, url, res;\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.prev = 0;\n                clientId = this.state.clientId;\n                if (clientId) {\n                  _context8.next = 4;\n                  break;\n                }\n                throw new Error(\"unspecified clientId\");\n              case 4:\n                url = new URL(\"https://api.developer.tor.us/whitelabel\");\n                url.searchParams.append(\"project_id\", this.state.clientId);\n                _context8.next = 8;\n                return get(url.href);\n              case 8:\n                res = _context8.sent;\n                return _context8.abrupt(\"return\", res.whiteLabel);\n              case 12:\n                _context8.prev = 12;\n                _context8.t0 = _context8[\"catch\"](0);\n                return _context8.abrupt(\"return\", {});\n              case 15:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this, [[0, 12]]);\n      }));\n      function getWhiteLabel() {\n        return _getWhiteLabel.apply(this, arguments);\n      }\n      return getWhiteLabel;\n    }()\n  }, {\n    key: \"_fastLogin\",\n    value: function () {\n      var _fastLogin2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9(params) {\n        var defaultParams, loginParams, res;\n        return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                defaultParams = {\n                  redirectUrl: this.state.redirectUrl\n                };\n                loginParams = _objectSpread(_objectSpread({}, defaultParams), params);\n                _context9.next = 4;\n                return this.request({\n                  params: [_objectSpread(_objectSpread({}, loginParams), {}, {\n                    fastLogin: true\n                  })],\n                  method: OPENLOGIN_METHOD.LOGIN,\n                  startUrl: this.state.startUrl,\n                  popupUrl: this.state.popupUrl,\n                  allowedInteractions: [ALLOWED_INTERACTIONS.POPUP, ALLOWED_INTERACTIONS.REDIRECT]\n                });\n              case 4:\n                res = _context9.sent;\n                this.state.privKey = res.privKey;\n                return _context9.abrupt(\"return\", res);\n              case 7:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n      function _fastLogin(_x9) {\n        return _fastLogin2.apply(this, arguments);\n      }\n      return _fastLogin;\n    }()\n  }, {\n    key: \"login\",\n    value: function () {\n      var _login = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(params) {\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                if (!(params !== null && params !== void 0 && params.loginProvider)) {\n                  _context10.next = 2;\n                  break;\n                }\n                return _context10.abrupt(\"return\", this._selectedLogin(params));\n              case 2:\n                return _context10.abrupt(\"return\", this._modal(params));\n              case 3:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n      function login(_x10) {\n        return _login.apply(this, arguments);\n      }\n      return login;\n    }()\n  }, {\n    key: \"_selectedLogin\",\n    value: function () {\n      var _selectedLogin2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11(params) {\n        var defaultParams, loginParams, res;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                defaultParams = {\n                  redirectUrl: this.state.redirectUrl\n                };\n                loginParams = _objectSpread(_objectSpread({\n                  loginProvider: params.loginProvider\n                }, defaultParams), params); // fast login flow\n                // if (this.state.store.get(\"touchIDPreference\") === \"enabled\" && !loginParams.extraLoginOptions?.login_hint) {\n                //   return this._fastLogin(loginParams);\n                // }\n                _context11.next = 4;\n                return this.request({\n                  method: OPENLOGIN_METHOD.LOGIN,\n                  allowedInteractions: [UX_MODE.REDIRECT, UX_MODE.POPUP],\n                  startUrl: this.state.startUrl,\n                  popupUrl: this.state.popupUrl,\n                  params: [loginParams]\n                });\n              case 4:\n                res = _context11.sent;\n                this.state.privKey = res.privKey;\n                if (!res.store) {\n                  _context11.next = 10;\n                  break;\n                }\n                this._syncState(res);\n                _context11.next = 16;\n                break;\n              case 10:\n                if (!(this.state.privKey && this.state.support3PC)) {\n                  _context11.next = 16;\n                  break;\n                }\n                _context11.t0 = this;\n                _context11.next = 14;\n                return this._getData();\n              case 14:\n                _context11.t1 = _context11.sent;\n                _context11.t0._syncState.call(_context11.t0, _context11.t1);\n              case 16:\n                return _context11.abrupt(\"return\", {\n                  privKey: this.privKey\n                });\n              case 17:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n      function _selectedLogin(_x11) {\n        return _selectedLogin2.apply(this, arguments);\n      }\n      return _selectedLogin;\n    }()\n  }, {\n    key: \"logout\",\n    value: function () {\n      var _logout = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12() {\n        var logoutParams,\n          params,\n          res,\n          _args12 = arguments;\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                logoutParams = _args12.length > 0 && _args12[0] !== undefined ? _args12[0] : {};\n                params = {}; // defaults\n                params.redirectUrl = this.state.redirectUrl;\n                params._clientId = this.state.clientId;\n                if (logoutParams.clientId) {\n                  params._clientId = logoutParams.clientId;\n                }\n                if (logoutParams.fastLogin !== undefined) {\n                  params.fastLogin = logoutParams.fastLogin;\n                }\n                if (logoutParams.redirectUrl !== undefined) {\n                  params.redirectUrl = logoutParams.redirectUrl;\n                }\n                _context12.next = 9;\n                return this.request({\n                  method: OPENLOGIN_METHOD.LOGOUT,\n                  params: [params],\n                  startUrl: this.state.startUrl,\n                  popupUrl: this.state.popupUrl,\n                  allowedInteractions: [ALLOWED_INTERACTIONS.JRPC, ALLOWED_INTERACTIONS.POPUP, ALLOWED_INTERACTIONS.REDIRECT]\n                });\n              case 9:\n                res = _context12.sent;\n                this.state.privKey = \"\"; // if (!params.fastLogin) this.state.store.set(\"touchIDPreference\", \"disabled\");\n                return _context12.abrupt(\"return\", res);\n              case 12:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n      function logout() {\n        return _logout.apply(this, arguments);\n      }\n      return logout;\n    }()\n  }, {\n    key: \"request\",\n    value: function () {\n      var _request = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13(args) {\n        var _params$0$redirectUrl, pid, params, session, startUrl, popupUrl, method, allowedInteractions, userData, sig, u, windowRef, _u, _windowRef;\n        return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                pid = randomId();\n                params = args.params; // Note: _origin is added later in postMessageStream for jrpc requests\n                // do not add it here since its used for checking postMessage constraints\n                session = {};\n                if (!(params.length !== 1)) {\n                  _context13.next = 5;\n                  break;\n                }\n                throw new Error(\"request params array should have only one element\");\n              case 5:\n                startUrl = args.startUrl, popupUrl = args.popupUrl, method = args.method, allowedInteractions = args.allowedInteractions;\n                if (!(allowedInteractions.length === 0)) {\n                  _context13.next = 8;\n                  break;\n                }\n                throw new Error(\"no allowed interactions\");\n              case 8:\n                if (this.state.clientId) {\n                  session._clientId = this.state.clientId;\n                }\n                if (!this.privKey) {\n                  _context13.next = 17;\n                  break;\n                }\n                userData = {\n                  clientId: session._clientId,\n                  timestamp: Date.now().toString()\n                };\n                _context13.next = 13;\n                return sign(Buffer.from(this.privKey, \"hex\"), Buffer.from(keccak(\"keccak256\").update(JSON.stringify(userData)).digest(\"hex\"), \"hex\"));\n              case 13:\n                sig = _context13.sent;\n                session._user = getPublic(Buffer.from(this.privKey, \"hex\")).toString(\"hex\");\n                session._userSig = base64url.encode(sig);\n                session._userData = userData;\n              case 17:\n                session._originData = this.state.originData;\n                session._whiteLabelData = this.state.whiteLabel;\n                session._loginConfig = this.state.loginConfig; // add in session data (allow overrides)\n\n                params = [_objectSpread(_objectSpread({}, session), params[0])]; // use JRPC where possible\n                if (!(this.state.support3PC && allowedInteractions.includes(ALLOWED_INTERACTIONS.JRPC))) {\n                  _context13.next = 23;\n                  break;\n                }\n                return _context13.abrupt(\"return\", this._jrpcRequest({\n                  method: method,\n                  params: params\n                }));\n              case 23:\n                // set origin\n\n                params[0]._origin = new URL((_params$0$redirectUrl = params[0].redirectUrl) !== null && _params$0$redirectUrl !== void 0 ? _params$0$redirectUrl : this.state.redirectUrl).origin; // preset params\n                if (!this.state.support3PC) {\n                  _context13.next = 28;\n                  break;\n                }\n                _context13.next = 27;\n                return this._setPIDData(pid, params);\n              case 27:\n                // eslint-disable-next-line require-atomic-updates\n\n                params = [{}];\n              case 28:\n                if (!(!startUrl || !popupUrl)) {\n                  _context13.next = 30;\n                  break;\n                }\n                throw new Error(\"no url for redirect / popup flow\");\n              case 30:\n                if (!(this.state.uxMode === UX_MODE.REDIRECT)) {\n                  _context13.next = 40;\n                  break;\n                }\n                if (!allowedInteractions.includes(ALLOWED_INTERACTIONS.REDIRECT)) {\n                  _context13.next = 34;\n                  break;\n                }\n                // give time for synchronous methods to complete before redirect\n                setTimeout(function () {\n                  window.location.href = constructURL({\n                    baseURL: startUrl,\n                    hash: {\n                      b64Params: jsonToBase64(params[0]),\n                      _pid: pid,\n                      _method: method\n                    }\n                  });\n                }, 50);\n                return _context13.abrupt(\"return\", {});\n              case 34:\n                if (!allowedInteractions.includes(ALLOWED_INTERACTIONS.POPUP)) {\n                  _context13.next = 38;\n                  break;\n                }\n                u = new URL(constructURL({\n                  baseURL: popupUrl,\n                  hash: {\n                    b64Params: jsonToBase64(params[0]),\n                    _pid: pid,\n                    _method: method\n                  }\n                }));\n                windowRef = window.open(u.toString(), \"_blank\", getPopupFeatures());\n                return _context13.abrupt(\"return\", awaitReq(pid, windowRef));\n              case 38:\n                _context13.next = 47;\n                break;\n              case 40:\n                if (!allowedInteractions.includes(ALLOWED_INTERACTIONS.POPUP)) {\n                  _context13.next = 44;\n                  break;\n                }\n                _u = new URL(constructURL({\n                  baseURL: popupUrl,\n                  hash: {\n                    b64Params: jsonToBase64(params[0]),\n                    _pid: pid,\n                    _method: method\n                  }\n                }));\n                _windowRef = window.open(_u.toString(), \"_blank\", getPopupFeatures());\n                return _context13.abrupt(\"return\", awaitReq(pid, _windowRef));\n              case 44:\n                if (!allowedInteractions.includes(ALLOWED_INTERACTIONS.REDIRECT)) {\n                  _context13.next = 47;\n                  break;\n                }\n                // give time for synchronous methods to complete before redirect\n                setTimeout(function () {\n                  window.location.href = constructURL({\n                    baseURL: startUrl,\n                    hash: {\n                      b64Params: jsonToBase64(params[0]),\n                      _pid: pid,\n                      _method: method\n                    }\n                  });\n                }, 50);\n                return _context13.abrupt(\"return\", null);\n              case 47:\n                throw new Error(\"no matching allowed interactions\");\n              case 48:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n      function request(_x12) {\n        return _request.apply(this, arguments);\n      }\n      return request;\n    }()\n  }, {\n    key: \"_jrpcRequest\",\n    value: function () {\n      var _jrpcRequest2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14(args) {\n        var _this4 = this;\n        var method, params;\n        return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                if (!(!args || typeof args !== \"object\" || Array.isArray(args))) {\n                  _context14.next = 2;\n                  break;\n                }\n                throw new Error(\"invalid request args\");\n              case 2:\n                method = args.method, params = args.params;\n                if (!(typeof method !== \"string\" || method.length === 0)) {\n                  _context14.next = 5;\n                  break;\n                }\n                throw new Error(\"invalid request method\");\n              case 5:\n                if (!(params === undefined || !Array.isArray(params))) {\n                  _context14.next = 7;\n                  break;\n                }\n                throw new Error(\"invalid request params\");\n              case 7:\n                if (params.length === 0) {\n                  params.push({});\n                }\n                return _context14.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  _this4.provider._rpcRequest({\n                    method: method,\n                    params: params\n                  }, getRpcPromiseCallback(resolve, reject));\n                }));\n              case 9:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14);\n      }));\n      function _jrpcRequest(_x13) {\n        return _jrpcRequest2.apply(this, arguments);\n      }\n      return _jrpcRequest;\n    }()\n  }, {\n    key: \"_check3PCSupport\",\n    value: function () {\n      var _check3PCSupport2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15() {\n        return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                return _context15.abrupt(\"return\", this._jrpcRequest({\n                  method: OPENLOGIN_METHOD.CHECK_3PC_SUPPORT,\n                  params: [{\n                    _originData: this.state.originData\n                  }]\n                }));\n              case 1:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n      function _check3PCSupport() {\n        return _check3PCSupport2.apply(this, arguments);\n      }\n      return _check3PCSupport;\n    }()\n  }, {\n    key: \"_setPIDData\",\n    value: function () {\n      var _setPIDData2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16(pid, data) {\n        return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                _context16.next = 2;\n                return this.request({\n                  allowedInteractions: [ALLOWED_INTERACTIONS.JRPC],\n                  method: OPENLOGIN_METHOD.SET_PID_DATA,\n                  params: [{\n                    pid: pid,\n                    data: data[0]\n                  }]\n                });\n              case 2:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this);\n      }));\n      function _setPIDData(_x14, _x15) {\n        return _setPIDData2.apply(this, arguments);\n      }\n      return _setPIDData;\n    }()\n  }, {\n    key: \"_getData\",\n    value: function () {\n      var _getData2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17() {\n        return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                return _context17.abrupt(\"return\", this.request({\n                  allowedInteractions: [ALLOWED_INTERACTIONS.JRPC],\n                  method: OPENLOGIN_METHOD.GET_DATA,\n                  params: [{}]\n                }));\n              case 1:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n      function _getData() {\n        return _getData2.apply(this, arguments);\n      }\n      return _getData;\n    }()\n  }, {\n    key: \"_syncState\",\n    value: function _syncState(newState) {\n      var _this5 = this;\n      if (newState.store) {\n        if (typeof newState.store !== \"object\") {\n          throw new Error(\"expected store to be an object\");\n        }\n        Object.keys(newState.store).forEach(function (key) {\n          // if privKey is available then user is not logged out, but in popup mode store info is not available.\n          // so we don't want to overwrite the local store if privKey is available\n          // and if latest iframe store data is not available\n          if (newState.privKey) {\n            if (newState.store[key]) {\n              _this5.state.store.set(key, newState.store[key]);\n            }\n          } else {\n            _this5.state.store.set(key, newState.store[key]);\n          }\n        });\n      }\n      var store = this.state.store;\n      this.state = _objectSpread(_objectSpread(_objectSpread({}, this.state), newState), {}, {\n        store: store\n      });\n    }\n  }, {\n    key: \"_modal\",\n    value: function () {\n      var _modal2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19(params) {\n        var _this6 = this;\n        return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                return _context19.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  _this6.modal._prompt(_this6.state.clientId, _this6.state.whiteLabel, _this6.state.loginConfig, /*#__PURE__*/function () {\n                    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18(chunk) {\n                      var selectedLoginResponse;\n                      return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n                        while (1) {\n                          switch (_context18.prev = _context18.next) {\n                            case 0:\n                              if (!chunk.cancel) {\n                                _context18.next = 4;\n                                break;\n                              }\n                              reject(new Error(\"user canceled login\"));\n                              _context18.next = 14;\n                              break;\n                            case 4:\n                              _context18.prev = 4;\n                              _context18.next = 7;\n                              return _this6._selectedLogin(merge(params, chunk));\n                            case 7:\n                              selectedLoginResponse = _context18.sent;\n                              resolve(selectedLoginResponse);\n                              _context18.next = 14;\n                              break;\n                            case 11:\n                              _context18.prev = 11;\n                              _context18.t0 = _context18[\"catch\"](4);\n                              reject(_context18.t0);\n                            case 14:\n                            case \"end\":\n                              return _context18.stop();\n                          }\n                        }\n                      }, _callee18, null, [[4, 11]]);\n                    }));\n                    return function (_x17) {\n                      return _ref6.apply(this, arguments);\n                    };\n                  }());\n                }));\n              case 1:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19);\n      }));\n      function _modal(_x16) {\n        return _modal2.apply(this, arguments);\n      }\n      return _modal;\n    }()\n  }, {\n    key: \"_cleanup\",\n    value: function () {\n      var _cleanup2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20() {\n        return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                _context20.next = 2;\n                return this.modal.cleanup();\n              case 2:\n                this.provider.cleanup();\n              case 3:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20, this);\n      }));\n      function _cleanup() {\n        return _cleanup2.apply(this, arguments);\n      }\n      return _cleanup;\n    }()\n  }, {\n    key: \"encrypt\",\n    value: function () {\n      var _encrypt2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21(message, privateKey) {\n        var privKey;\n        return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                privKey = privateKey;\n                if (!privKey) {\n                  privKey = this.privKey;\n                } // validations\n                if (/^[0-9a-fA-f]{64}$/.exec(privKey)) {\n                  _context21.next = 8;\n                  break;\n                }\n                if (!(privKey === \"\" || privKey === undefined)) {\n                  _context21.next = 7;\n                  break;\n                }\n                throw new Error(\"private key cannot be empty\");\n              case 7:\n                throw new Error(\"invalid private key in encrypt\");\n              case 8:\n                return _context21.abrupt(\"return\", _encrypt(getPublic(Buffer.from(privKey, \"hex\")), message));\n              case 9:\n              case \"end\":\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this);\n      }));\n      function encrypt(_x18, _x19) {\n        return _encrypt2.apply(this, arguments);\n      }\n      return encrypt;\n    }()\n  }, {\n    key: \"decrypt\",\n    value: function () {\n      var _decrypt2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee22(ciphertext, privateKey) {\n        var privKey;\n        return _regeneratorRuntime().wrap(function _callee22$(_context22) {\n          while (1) {\n            switch (_context22.prev = _context22.next) {\n              case 0:\n                privKey = privateKey;\n                if (!privKey) {\n                  privKey = this.privKey;\n                } // validations\n                if (/^[0-9a-fA-f]{64}$/.exec(privKey)) {\n                  _context22.next = 8;\n                  break;\n                }\n                if (!(privKey === \"\" || privKey === undefined)) {\n                  _context22.next = 7;\n                  break;\n                }\n                throw new Error(\"private key cannot be empty\");\n              case 7:\n                throw new Error(\"invalid private key in decrypt\");\n              case 8:\n                return _context22.abrupt(\"return\", _decrypt(Buffer.from(privKey, \"hex\"), ciphertext));\n              case 9:\n              case \"end\":\n                return _context22.stop();\n            }\n          }\n        }, _callee22, this);\n      }));\n      function decrypt(_x20, _x21) {\n        return _decrypt2.apply(this, arguments);\n      }\n      return decrypt;\n    }()\n  }, {\n    key: \"getUserInfo\",\n    value: function () {\n      var _getUserInfo = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee23() {\n        var storeData, userInfo;\n        return _regeneratorRuntime().wrap(function _callee23$(_context23) {\n          while (1) {\n            switch (_context23.prev = _context23.next) {\n              case 0:\n                if (!this.privKey) {\n                  _context23.next = 4;\n                  break;\n                }\n                storeData = this.state.store.getStore();\n                userInfo = {\n                  email: storeData.email || \"\",\n                  name: storeData.name || \"\",\n                  profileImage: storeData.profileImage || \"\",\n                  aggregateVerifier: storeData.aggregateVerifier || \"\",\n                  verifier: storeData.verifier || \"\",\n                  verifierId: storeData.verifierId || \"\",\n                  typeOfLogin: storeData.typeOfLogin || \"\",\n                  dappShare: storeData.dappShare || \"\"\n                };\n                return _context23.abrupt(\"return\", userInfo);\n              case 4:\n                throw new Error(\"user should be logged in to fetch userInfo\");\n              case 5:\n              case \"end\":\n                return _context23.stop();\n            }\n          }\n        }, _callee23, this);\n      }));\n      function getUserInfo() {\n        return _getUserInfo.apply(this, arguments);\n      }\n      return getUserInfo;\n    }()\n  }, {\n    key: \"getEncodedLoginUrl\",\n    value: function () {\n      var _getEncodedLoginUrl = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee24(loginParams) {\n        var redirectUrl, clientId, dataObject, b64Params, hashParams;\n        return _regeneratorRuntime().wrap(function _callee24$(_context24) {\n          while (1) {\n            switch (_context24.prev = _context24.next) {\n              case 0:\n                redirectUrl = loginParams.redirectUrl;\n                clientId = this.state.clientId;\n                if (this.state.originData[origin]) {\n                  _context24.next = 5;\n                  break;\n                }\n                _context24.next = 5;\n                return this.updateOriginData();\n              case 5:\n                dataObject = _objectSpread({\n                  _clientId: clientId,\n                  _origin: new URL(redirectUrl).origin,\n                  _originData: this.state.originData,\n                  redirectUrl: redirectUrl\n                }, loginParams);\n                b64Params = jsonToBase64(dataObject);\n                hashParams = {\n                  b64Params: b64Params,\n                  _method: \"openlogin_login\"\n                };\n                return _context24.abrupt(\"return\", constructURL({\n                  baseURL: \"\".concat(this.state.iframeUrl, \"/start\"),\n                  hash: hashParams\n                }));\n              case 9:\n              case \"end\":\n                return _context24.stop();\n            }\n          }\n        }, _callee24, this);\n      }));\n      function getEncodedLoginUrl(_x22) {\n        return _getEncodedLoginUrl.apply(this, arguments);\n      }\n      return getEncodedLoginUrl;\n    }()\n  }]);\n  return OpenLogin;\n}();\nexport { ALLOWED_INTERACTIONS, LOGIN_PROVIDER, MFA_LEVELS, OPENLOGIN_METHOD, OPENLOGIN_NETWORK, OpenLoginStore, Provider, UX_MODE, awaitReq, constructURL, OpenLogin as default, documentReady, getHashQueryParams, getPopupFeatures, htmlToElement, localStorageAvailable, log as loglevel, modalDOMElementID, preloadIframe, sessionStorageAvailable, storageAvailable, storeKey, whitelistUrl };","map":{"version":3,"sources":["../src/constants.ts","../src/loglevel.ts","../src/utils.ts","../src/Modal.ts","../src/MemoryStore.ts","../src/OpenLoginStore.ts","../src/Provider.ts","../src/OpenLogin.ts"],"names":["modalDOMElementID","storeKey","UX_MODE","POPUP","REDIRECT","OPENLOGIN_METHOD","LOGIN","LOGOUT","CHECK_3PC_SUPPORT","SET_PID_DATA","GET_DATA","ALLOWED_INTERACTIONS","JRPC","OPENLOGIN_NETWORK","MAINNET","TESTNET","CYAN","DEVELOPMENT","LOGIN_PROVIDER","GOOGLE","FACEBOOK","REDDIT","DISCORD","TWITCH","APPLE","LINE","GITHUB","KAKAO","LINKEDIN","TWITTER","WEIBO","WECHAT","EMAIL_PASSWORDLESS","WEBAUTHN","JWT","MFA_LEVELS","DEFAULT","OPTIONAL","MANDATORY","NONE","loglevel","setLevel","getLogger","documentReady","Promise","resolve","document","readyState","addEventListener","htmlToElement","html","template","window","createElement","trimmedHtml","trim","innerHTML","content","firstChild","whitelistUrl","clientId","appKey","origin","appKeyBuf","Buffer","from","padStart","base64url","encode","getPublic","Error","sig","sign","keccak","update","digest","replaceUrl","result","url","URL","location","href","searchParams","forEach","value","key","queryResult","get","queryParams","JSON","parse","safeatob","Object","keys","error","log","hash","substring","hashUrl","hashResult","hashParams","cleanUrl","pathname","history","replaceState","id","windowRef","reject","closedByHandler","closedMonitor","setInterval","closed","clearInterval","handler","ev","pid","data","removeEventListener","close","constructURL","params","baseURL","query","append","h","toString","storageAvailable","type","storageExists","storageLength","storage","length","x","setItem","removeItem","code","name","sessionStorageAvailable","localStorageAvailable","preloadIframe","openloginIframeHtml","crossOrigin","rel","relList","supports","head","appendChild","getPopupFeatures","dualScreenLeft","screenLeft","undefined","screenX","dualScreenTop","screenTop","screenY","w","width","innerWidth","documentElement","clientWidth","screen","height","innerHeight","clientHeight","systemZoom","left","Math","abs","top","features","handleStream","handle","eventName","handlerWrapper","chunk","removeListener","on","Modal","constructor","modalUrl","init","initIFrame","setupStream","iframeElem","mux","setupMultiplex","PostMessageStream","target","targetWindow","contentWindow","targetOrigin","verifierStream","createStream","src","documentIFrameElem","getElementById","remove","info","modalZIndex","_hideModal","body","onload","initialized","_showModal","style","display","position","right","bottom","border","setAttribute","entries","map","k","v","join","_prompt","whiteLabel","loginConfig","cb","modalHandler","write","cleanup","MemoryStore","getItem","store","OpenLoginStore","resetStore","getInstance","instance","localStorage","toJSON","currStore","getStore","stringify","set","SafeEventEmitter","iframeUrl","rpcStream","JRPCConnection","createStreamMiddleware","pump","stream","rpcEngine","JRPCEngine","push","createIdRemapMiddleware","middleware","_rpcRequest","payload","callback","jsonrpc","randomId","OpenLogin","options","provider","Proxy","Provider","deleteProperty","_iframeUrl","network","modal","initState","no3PC","_startUrl","_popupUrl","redirectUrl","protocol","host","uxMode","replaceUrlOnRedirect","originData","privKey","state","startUrl","popupUrl","support3PC","all","updateOriginData","_syncState","_getData","getHashQueryParams","res","_check3PCSupport","filteredOriginData","whitelist","getWhitelist","getWhiteLabel","signed_urls","_fastLogin","defaultParams","loginParams","request","fastLogin","method","allowedInteractions","login","loginProvider","_selectedLogin","_modal","logout","logoutParams","_clientId","args","session","userData","timestamp","Date","now","_user","_userSig","_userData","_originData","_whiteLabelData","_loginConfig","includes","_jrpcRequest","_origin","_setPIDData","setTimeout","b64Params","jsonToBase64","_pid","_method","u","open","awaitReq","Array","isArray","getRpcPromiseCallback","newState","cancel","selectedLoginResponse","merge","_cleanup","encrypt","message","privateKey","exec","decrypt","ciphertext","getUserInfo","storeData","userInfo","email","profileImage","aggregateVerifier","verifier","verifierId","typeOfLogin","dappShare","getEncodedLoginUrl","dataObject"],"mappings":"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","sourcesContent":["import loglevel from 'loglevel';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { getPublic, sign, encrypt, decrypt } from '@toruslabs/eccrypto';\nimport { get } from '@toruslabs/http-helpers';\nimport { setupMultiplex, PostMessageStream, SafeEventEmitter, createStreamMiddleware, JRPCEngine, createIdRemapMiddleware, getRpcPromiseCallback } from '@toruslabs/openlogin-jrpc';\nimport { base64url, keccak, safeatob, randomId, jsonToBase64 } from '@toruslabs/openlogin-utils';\nimport merge from 'lodash.merge';\nimport pump from 'pump';\n\nconst modalDOMElementID = \"openlogin-modal\";\nconst storeKey = \"openlogin_store\";\nconst UX_MODE = {\n  POPUP: \"popup\",\n  REDIRECT: \"redirect\"\n};\nconst OPENLOGIN_METHOD = {\n  LOGIN: \"openlogin_login\",\n  LOGOUT: \"openlogin_logout\",\n  CHECK_3PC_SUPPORT: \"openlogin_check_3PC_support\",\n  SET_PID_DATA: \"openlogin_set_pid_data\",\n  GET_DATA: \"openlogin_get_data\"\n};\nconst ALLOWED_INTERACTIONS = {\n  POPUP: \"popup\",\n  REDIRECT: \"redirect\",\n  JRPC: \"jrpc\"\n};\nconst OPENLOGIN_NETWORK = {\n  MAINNET: \"mainnet\",\n  TESTNET: \"testnet\",\n  CYAN: \"cyan\",\n  DEVELOPMENT: \"development\"\n};\nconst LOGIN_PROVIDER = {\n  GOOGLE: \"google\",\n  FACEBOOK: \"facebook\",\n  REDDIT: \"reddit\",\n  DISCORD: \"discord\",\n  TWITCH: \"twitch\",\n  APPLE: \"apple\",\n  LINE: \"line\",\n  GITHUB: \"github\",\n  KAKAO: \"kakao\",\n  LINKEDIN: \"linkedin\",\n  TWITTER: \"twitter\",\n  WEIBO: \"weibo\",\n  WECHAT: \"wechat\",\n  EMAIL_PASSWORDLESS: \"email_passwordless\",\n  WEBAUTHN: \"webauthn\",\n  JWT: \"jwt\"\n};\nconst MFA_LEVELS = {\n  DEFAULT: \"default\",\n  OPTIONAL: \"optional\",\n  MANDATORY: \"mandatory\",\n  NONE: \"none\"\n};\n\nloglevel.setLevel(\"error\");\nvar log = loglevel.getLogger(\"openlogin\");\n\nasync function documentReady() {\n  return new Promise(resolve => {\n    if (document.readyState !== \"loading\") {\n      resolve();\n    } else {\n      document.addEventListener(\"DOMContentLoaded\", () => {\n        resolve();\n      });\n    }\n  });\n}\nconst htmlToElement = html => {\n  const template = window.document.createElement(\"template\");\n  const trimmedHtml = html.trim(); // Never return a text node of whitespace as the result\n\n  template.innerHTML = trimmedHtml;\n  return template.content.firstChild;\n};\nasync function whitelistUrl(clientId, appKey, origin) {\n  const appKeyBuf = Buffer.from(appKey.padStart(64, \"0\"), \"hex\");\n  if (base64url.encode(getPublic(appKeyBuf)) !== clientId) throw new Error(\"appKey mismatch\");\n  const sig = await sign(appKeyBuf, Buffer.from(keccak(\"keccak256\").update(origin).digest(\"hex\"), \"hex\"));\n  return base64url.encode(sig);\n}\nfunction getHashQueryParams() {\n  let replaceUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n  const result = {};\n  const url = new URL(window.location.href);\n  url.searchParams.forEach((value, key) => {\n    if (key !== \"result\") {\n      result[key] = value;\n    }\n  });\n  const queryResult = url.searchParams.get(\"result\");\n\n  if (queryResult) {\n    try {\n      const queryParams = JSON.parse(safeatob(queryResult));\n      Object.keys(queryParams).forEach(key => {\n        result[key] = queryParams[key];\n      });\n    } catch (error) {\n      log.error(error);\n    }\n  }\n\n  const hash = url.hash.substring(1);\n  const hashUrl = new URL(\"\".concat(window.location.origin, \"/?\").concat(hash));\n  hashUrl.searchParams.forEach((value, key) => {\n    if (key !== \"result\") {\n      result[key] = value;\n    }\n  });\n  const hashResult = hashUrl.searchParams.get(\"result\");\n\n  if (hashResult) {\n    try {\n      const hashParams = JSON.parse(safeatob(hashResult));\n      Object.keys(hashParams).forEach(key => {\n        result[key] = hashParams[key];\n      });\n    } catch (error) {\n      log.error(error);\n    }\n  }\n\n  if (replaceUrl) {\n    const cleanUrl = window.location.origin + window.location.pathname;\n    window.history.replaceState(null, \"\", cleanUrl);\n  }\n\n  return result;\n}\nfunction awaitReq(id, windowRef) {\n  return new Promise((resolve, reject) => {\n    if (!windowRef) reject(new Error(\"Unable to open window\"));\n    let closedByHandler = false;\n    const closedMonitor = setInterval(() => {\n      if (!closedByHandler && windowRef.closed) {\n        clearInterval(closedMonitor);\n        reject(new Error(\"user closed popup\"));\n      }\n    }, 500);\n\n    const handler = ev => {\n      const {\n        pid\n      } = ev.data;\n      if (id !== pid) return;\n      window.removeEventListener(\"message\", handler);\n      closedByHandler = true;\n      clearInterval(closedMonitor);\n      windowRef.close();\n\n      if (ev.data.data && ev.data.data.error) {\n        reject(new Error(ev.data.data.error));\n      } else {\n        resolve(ev.data.data);\n      }\n    };\n\n    window.addEventListener(\"message\", handler);\n  });\n}\nfunction constructURL(params) {\n  const {\n    baseURL,\n    query,\n    hash\n  } = params;\n  const url = new URL(baseURL);\n\n  if (query) {\n    Object.keys(query).forEach(key => {\n      url.searchParams.append(key, query[key]);\n    });\n  }\n\n  if (hash) {\n    const h = new URL(constructURL({\n      baseURL,\n      query: hash\n    })).searchParams.toString();\n    url.hash = h;\n  }\n\n  return url.toString();\n}\nfunction storageAvailable(type) {\n  let storageExists = false;\n  let storageLength = 0;\n  let storage;\n\n  try {\n    storage = window[type];\n    storageExists = true;\n    storageLength = storage.length;\n    const x = \"__storage_test__\";\n    storage.setItem(x, x);\n    storage.removeItem(x);\n    return true;\n  } catch (error) {\n    return error && ( // everything except Firefox\n    error.code === 22 || // Firefox\n    error.code === 1014 || // test name field too, because code might not be present\n    // everything except Firefox\n    error.name === \"QuotaExceededErro r\" || // Firefox\n    error.name === \"NS_ERROR_DOM_QUOTA_REACHED\") && // acknowledge QuotaExceededError only if there's something already stored\n    storageExists && storageLength !== 0;\n  }\n}\nconst sessionStorageAvailable = storageAvailable(\"sessionStorage\");\nconst localStorageAvailable = storageAvailable(\"localStorage\");\nfunction preloadIframe(url) {\n  try {\n    if (typeof document === \"undefined\") return;\n    const openloginIframeHtml = document.createElement(\"link\");\n    openloginIframeHtml.href = url;\n    openloginIframeHtml.crossOrigin = \"anonymous\";\n    openloginIframeHtml.type = \"text/html\";\n    openloginIframeHtml.rel = \"prefetch\";\n\n    if (openloginIframeHtml.relList && openloginIframeHtml.relList.supports) {\n      if (openloginIframeHtml.relList.supports(\"prefetch\")) {\n        document.head.appendChild(openloginIframeHtml);\n      }\n    }\n  } catch (error) {\n    log.error(error);\n  }\n}\nfunction getPopupFeatures() {\n  // Fixes dual-screen position                             Most browsers      Firefox\n  const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;\n  const dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;\n  const w = 1200;\n  const h = 700;\n  const width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : window.screen.width;\n  const height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : window.screen.height;\n  const systemZoom = 1; // No reliable estimate\n\n  const left = Math.abs((width - w) / 2 / systemZoom + dualScreenLeft);\n  const top = Math.abs((height - h) / 2 / systemZoom + dualScreenTop);\n  const features = \"titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=\".concat(h / systemZoom, \",width=\").concat(w / systemZoom, \",top=\").concat(top, \",left=\").concat(left);\n  return features;\n}\n\nconst handleStream = (handle, eventName, handler) => {\n  const handlerWrapper = chunk => {\n    handler(chunk);\n    handle.removeListener(eventName, handlerWrapper);\n  };\n\n  handle.on(eventName, handlerWrapper);\n};\nclass Modal {\n  constructor(modalUrl) {\n    _defineProperty(this, \"modalUrl\", void 0);\n\n    _defineProperty(this, \"iframeElem\", void 0);\n\n    _defineProperty(this, \"initialized\", false);\n\n    _defineProperty(this, \"modalZIndex\", 99999);\n\n    _defineProperty(this, \"mux\", void 0);\n\n    _defineProperty(this, \"verifierStream\", void 0);\n\n    this.modalUrl = modalUrl;\n  }\n\n  async init() {\n    await this.initIFrame(this.modalUrl);\n    this.setupStream();\n  }\n\n  setupStream() {\n    if (this.iframeElem === null) throw new Error(\"iframe is null\");\n    this.mux = setupMultiplex(new PostMessageStream({\n      name: \"modal_iframe_rpc\",\n      target: \"modal_rpc\",\n      targetWindow: this.iframeElem.contentWindow,\n      targetOrigin: new URL(this.modalUrl).origin\n    }));\n    this.verifierStream = this.mux.createStream(\"verifier\");\n  }\n\n  async initIFrame(src) {\n    await documentReady();\n    const documentIFrameElem = document.getElementById(modalDOMElementID);\n\n    if (documentIFrameElem) {\n      documentIFrameElem.remove();\n      log.info(\"already initialized, removing previous modal iframe\");\n    }\n\n    this.iframeElem = htmlToElement(\"<iframe\\n        id=\".concat(modalDOMElementID, \"\\n        class=\\\"torusIframe\\\"\\n        src=\\\"\").concat(src, \"\\\"\\n        style=\\\"display: none; position: fixed; top: 0; right: 0; width: 100%;\\n        height: 100%; border: none; border-radius: 0; z-index: \").concat(this.modalZIndex.toString(), \"\\\"\\n      ></iframe>\"));\n\n    this._hideModal();\n\n    document.body.appendChild(this.iframeElem);\n    return new Promise(resolve => {\n      this.iframeElem.onload = () => {\n        this.initialized = true;\n        resolve();\n      };\n    });\n  }\n\n  _showModal() {\n    const style = {};\n    style.display = \"block\";\n    style.position = \"fixed\";\n    style.width = \"100%\";\n    style.height = \"100%\";\n    style.top = \"0px\";\n    style.right = \"0px\";\n    style.left = \"0px\";\n    style.bottom = \"0px\";\n    style.border = \"0\";\n    style[\"z-index\"] = this.modalZIndex;\n    this.iframeElem.setAttribute(\"style\", Object.entries(style).map(_ref => {\n      let [k, v] = _ref;\n      return \"\".concat(k, \":\").concat(v);\n    }).join(\";\"));\n  }\n\n  _hideModal() {\n    const style = {};\n    style.display = \"none\";\n    style.position = \"fixed\";\n    style.width = \"100%\";\n    style.height = \"100%\";\n    style.top = \"0px\";\n    style.right = \"0px\";\n    style.left = \"0px\";\n    style.bottom = \"0px\";\n    style.border = \"0\";\n    style[\"z-index\"] = this.modalZIndex;\n    this.iframeElem.setAttribute(\"style\", Object.entries(style).map(_ref2 => {\n      let [k, v] = _ref2;\n      return \"\".concat(k, \":\").concat(v);\n    }).join(\";\"));\n  }\n\n  async _prompt(clientId, whiteLabel, loginConfig, cb) {\n    this._showModal();\n\n    const modalHandler = chunk => {\n      this._hideModal();\n\n      cb(chunk);\n    };\n\n    handleStream(this.verifierStream, \"data\", modalHandler);\n    this.verifierStream.write({\n      name: \"prompt\",\n      clientId,\n      whiteLabel,\n      loginConfig\n    });\n  }\n\n  async cleanup() {\n    await documentReady();\n    const documentIFrameElem = document.getElementById(modalDOMElementID);\n\n    if (documentIFrameElem) {\n      documentIFrameElem.remove();\n      this.iframeElem = null;\n    }\n\n    this.initialized = false;\n  }\n\n}\n\nclass MemoryStore {\n  constructor() {\n    _defineProperty(this, \"store\", {});\n  }\n\n  getItem(key) {\n    return this.store[key];\n  }\n\n  setItem(key, value) {\n    this.store[key] = value;\n  }\n\n}\n\nclass OpenLoginStore {\n  // eslint-disable-next-line no-use-before-define\n  constructor(storage) {\n    _defineProperty(this, \"storage\", void 0);\n\n    this.storage = storage;\n\n    try {\n      if (!storage.getItem(storeKey)) {\n        this.resetStore();\n      }\n    } catch (error) {// Storage is not available\n    }\n  }\n\n  static getInstance() {\n    if (!this.instance) {\n      this.instance = new this(localStorageAvailable ? localStorage : new MemoryStore());\n    }\n\n    return this.instance;\n  }\n\n  toJSON() {\n    return this.storage.getItem(storeKey);\n  }\n\n  resetStore() {\n    const currStore = this.getStore();\n    this.storage.setItem(storeKey, JSON.stringify({}));\n    return currStore;\n  }\n\n  getStore() {\n    return JSON.parse(this.storage.getItem(storeKey));\n  }\n\n  get(key) {\n    const store = JSON.parse(this.storage.getItem(storeKey));\n    return store[key];\n  }\n\n  set(key, value) {\n    const store = JSON.parse(this.storage.getItem(storeKey));\n    store[key] = value;\n    this.storage.setItem(storeKey, JSON.stringify(store));\n  }\n\n}\n\n_defineProperty(OpenLoginStore, \"instance\", void 0);\n\nclass Provider extends SafeEventEmitter {\n  constructor() {\n    super(...arguments);\n\n    _defineProperty(this, \"iframeElem\", null);\n\n    _defineProperty(this, \"rpcStream\", void 0);\n\n    _defineProperty(this, \"iframeUrl\", void 0);\n\n    _defineProperty(this, \"rpcEngine\", void 0);\n\n    _defineProperty(this, \"initialized\", void 0);\n\n    _defineProperty(this, \"mux\", void 0);\n  }\n\n  init(_ref) {\n    let {\n      iframeElem,\n      iframeUrl\n    } = _ref;\n    this.iframeElem = iframeElem;\n    this.iframeUrl = iframeUrl;\n    this.setupStream();\n    this.initialized = true;\n  }\n\n  setupStream() {\n    if (this.iframeElem === null) throw new Error(\"iframe is null\");\n    this.rpcStream = new PostMessageStream({\n      name: \"embed_rpc\",\n      target: \"iframe_rpc\",\n      targetWindow: this.iframeElem.contentWindow,\n      targetOrigin: new URL(this.iframeUrl).origin\n    });\n    this.mux = setupMultiplex(this.rpcStream);\n    const JRPCConnection = createStreamMiddleware();\n    pump(JRPCConnection.stream, this.mux.createStream(\"jrpc\"), JRPCConnection.stream, error => {\n      log.error(\"JRPC connection broken\", error);\n    });\n    const rpcEngine = new JRPCEngine();\n    rpcEngine.push(createIdRemapMiddleware());\n    rpcEngine.push(JRPCConnection.middleware);\n    this.rpcEngine = rpcEngine;\n  }\n\n  cleanup() {\n    this.iframeElem = null;\n    this.initialized = false;\n  }\n\n  _rpcRequest(payload, callback) {\n    if (!payload.jsonrpc) {\n      payload.jsonrpc = \"2.0\";\n    }\n\n    if (!payload.id) {\n      payload.id = randomId();\n    }\n\n    this.rpcEngine.handle(payload, callback);\n  }\n\n}\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\npreloadIframe(\"https://app.openlogin.com/sdk-modal\");\n\nclass OpenLogin {\n  constructor(options) {\n    var _options$no3PC, _options$_startUrl, _options$_popupUrl, _options$redirectUrl, _options$uxMode, _options$replaceUrlOn, _options$originData, _options$whiteLabel, _options$loginConfig;\n\n    _defineProperty(this, \"provider\", void 0);\n\n    _defineProperty(this, \"state\", void 0);\n\n    _defineProperty(this, \"modal\", void 0);\n\n    this.provider = new Proxy(new Provider(), {\n      deleteProperty: () => true // work around for web3\n\n    });\n\n    if (!options._iframeUrl) {\n      if (options.network === OPENLOGIN_NETWORK.MAINNET) {\n        options._iframeUrl = \"https://app.openlogin.com\";\n      } else if (options.network === OPENLOGIN_NETWORK.CYAN) {\n        options._iframeUrl = \"https://cyan.openlogin.com\";\n      } else if (options.network === OPENLOGIN_NETWORK.TESTNET) {\n        options._iframeUrl = \"https://beta.openlogin.com\";\n      } else if (options.network === OPENLOGIN_NETWORK.DEVELOPMENT) {\n        options._iframeUrl = \"http://localhost:3000\";\n      }\n    }\n\n    if (!options._iframeUrl) {\n      throw new Error(\"unspecified network and iframeUrl\");\n    }\n\n    this.modal = new Modal(\"\".concat(options._iframeUrl, \"/sdk-modal\"));\n    this.initState(_objectSpread(_objectSpread({}, options), {}, {\n      no3PC: (_options$no3PC = options.no3PC) !== null && _options$no3PC !== void 0 ? _options$no3PC : false,\n      _iframeUrl: options._iframeUrl,\n      _startUrl: (_options$_startUrl = options._startUrl) !== null && _options$_startUrl !== void 0 ? _options$_startUrl : \"\".concat(options._iframeUrl, \"/start\"),\n      _popupUrl: (_options$_popupUrl = options._popupUrl) !== null && _options$_popupUrl !== void 0 ? _options$_popupUrl : \"\".concat(options._iframeUrl, \"/popup-window\"),\n      redirectUrl: (_options$redirectUrl = options.redirectUrl) !== null && _options$redirectUrl !== void 0 ? _options$redirectUrl : \"\".concat(window.location.protocol, \"//\").concat(window.location.host).concat(window.location.pathname),\n      uxMode: (_options$uxMode = options.uxMode) !== null && _options$uxMode !== void 0 ? _options$uxMode : UX_MODE.REDIRECT,\n      replaceUrlOnRedirect: (_options$replaceUrlOn = options.replaceUrlOnRedirect) !== null && _options$replaceUrlOn !== void 0 ? _options$replaceUrlOn : true,\n      originData: (_options$originData = options.originData) !== null && _options$originData !== void 0 ? _options$originData : {\n        [window.location.origin]: \"\"\n      },\n      whiteLabel: (_options$whiteLabel = options.whiteLabel) !== null && _options$whiteLabel !== void 0 ? _options$whiteLabel : {},\n      loginConfig: (_options$loginConfig = options.loginConfig) !== null && _options$loginConfig !== void 0 ? _options$loginConfig : {}\n    }));\n  }\n\n  get privKey() {\n    return this.state.privKey ? this.state.privKey.padStart(64, \"0\") : \"\";\n  }\n\n  initState(options) {\n    this.state = {\n      uxMode: options.uxMode,\n      network: options.network,\n      store: OpenLoginStore.getInstance(),\n      iframeUrl: options._iframeUrl,\n      startUrl: options._startUrl,\n      popupUrl: options._popupUrl,\n      clientId: options.clientId,\n      redirectUrl: options.redirectUrl,\n      replaceUrlOnRedirect: options.replaceUrlOnRedirect,\n      originData: options.originData,\n      loginConfig: options.loginConfig,\n      support3PC: !options.no3PC,\n      whiteLabel: options.whiteLabel\n    };\n  }\n\n  async init() {\n    if (this.state.support3PC) {\n      await Promise.all([this.modal.init(), this.updateOriginData()]);\n      this.provider.init({\n        iframeElem: this.modal.iframeElem,\n        iframeUrl: this.state.iframeUrl\n      });\n\n      this._syncState(await this._getData());\n\n      this._syncState(getHashQueryParams(this.state.replaceUrlOnRedirect));\n\n      const res = await this._check3PCSupport();\n      this.state.support3PC = !!res.support3PC;\n    } else {\n      await this.updateOriginData();\n\n      this._syncState(getHashQueryParams(this.state.replaceUrlOnRedirect));\n    }\n  }\n\n  async updateOriginData() {\n    const filteredOriginData = JSON.parse(JSON.stringify(this.state.originData));\n    Object.keys(filteredOriginData).forEach(key => {\n      if (filteredOriginData[key] === \"\") delete filteredOriginData[key];\n    });\n    const [whitelist, whiteLabel] = await Promise.all([this.getWhitelist(), this.getWhiteLabel()]);\n\n    this._syncState({\n      originData: _objectSpread(_objectSpread({}, whitelist), filteredOriginData),\n      whiteLabel: _objectSpread(_objectSpread({}, whiteLabel), this.state.whiteLabel)\n    });\n  }\n\n  async getWhitelist() {\n    try {\n      const {\n        clientId\n      } = this.state;\n\n      if (!clientId) {\n        throw new Error(\"unspecified clientId\");\n      }\n\n      const url = new URL(\"https://api.developer.tor.us/whitelist\");\n      url.searchParams.append(\"project_id\", this.state.clientId);\n      const res = await get(url.href);\n      return res.signed_urls;\n    } catch (_) {\n      // fail silently\n      return {};\n    }\n  }\n\n  async getWhiteLabel() {\n    try {\n      const {\n        clientId\n      } = this.state;\n\n      if (!clientId) {\n        throw new Error(\"unspecified clientId\");\n      }\n\n      const url = new URL(\"https://api.developer.tor.us/whitelabel\");\n      url.searchParams.append(\"project_id\", this.state.clientId);\n      const res = await get(url.href);\n      return res.whiteLabel;\n    } catch (_) {\n      // fail silently\n      return {};\n    }\n  }\n\n  async _fastLogin(params) {\n    const defaultParams = {\n      redirectUrl: this.state.redirectUrl\n    };\n\n    const loginParams = _objectSpread(_objectSpread({}, defaultParams), params);\n\n    const res = await this.request({\n      params: [_objectSpread(_objectSpread({}, loginParams), {}, {\n        fastLogin: true\n      })],\n      method: OPENLOGIN_METHOD.LOGIN,\n      startUrl: this.state.startUrl,\n      popupUrl: this.state.popupUrl,\n      allowedInteractions: [ALLOWED_INTERACTIONS.POPUP, ALLOWED_INTERACTIONS.REDIRECT]\n    });\n    this.state.privKey = res.privKey;\n    return res;\n  }\n\n  async login(params) {\n    if (params !== null && params !== void 0 && params.loginProvider) {\n      return this._selectedLogin(params);\n    }\n\n    return this._modal(params);\n  }\n\n  async _selectedLogin(params) {\n    const defaultParams = {\n      redirectUrl: this.state.redirectUrl\n    };\n\n    const loginParams = _objectSpread(_objectSpread({\n      loginProvider: params.loginProvider\n    }, defaultParams), params); // fast login flow\n    // if (this.state.store.get(\"touchIDPreference\") === \"enabled\" && !loginParams.extraLoginOptions?.login_hint) {\n    //   return this._fastLogin(loginParams);\n    // }\n\n\n    const res = await this.request({\n      method: OPENLOGIN_METHOD.LOGIN,\n      allowedInteractions: [UX_MODE.REDIRECT, UX_MODE.POPUP],\n      startUrl: this.state.startUrl,\n      popupUrl: this.state.popupUrl,\n      params: [loginParams]\n    });\n    this.state.privKey = res.privKey;\n\n    if (res.store) {\n      this._syncState(res);\n    } else if (this.state.privKey && this.state.support3PC) {\n      this._syncState(await this._getData());\n    }\n\n    return {\n      privKey: this.privKey\n    };\n  }\n\n  async logout() {\n    let logoutParams = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const params = {}; // defaults\n\n    params.redirectUrl = this.state.redirectUrl;\n    params._clientId = this.state.clientId;\n\n    if (logoutParams.clientId) {\n      params._clientId = logoutParams.clientId;\n    }\n\n    if (logoutParams.fastLogin !== undefined) {\n      params.fastLogin = logoutParams.fastLogin;\n    }\n\n    if (logoutParams.redirectUrl !== undefined) {\n      params.redirectUrl = logoutParams.redirectUrl;\n    }\n\n    const res = await this.request({\n      method: OPENLOGIN_METHOD.LOGOUT,\n      params: [params],\n      startUrl: this.state.startUrl,\n      popupUrl: this.state.popupUrl,\n      allowedInteractions: [ALLOWED_INTERACTIONS.JRPC, ALLOWED_INTERACTIONS.POPUP, ALLOWED_INTERACTIONS.REDIRECT]\n    });\n    this.state.privKey = \"\"; // if (!params.fastLogin) this.state.store.set(\"touchIDPreference\", \"disabled\");\n\n    return res;\n  }\n\n  async request(args) {\n    var _params$0$redirectUrl;\n\n    const pid = randomId();\n    let {\n      params\n    } = args; // Note: _origin is added later in postMessageStream for jrpc requests\n    // do not add it here since its used for checking postMessage constraints\n\n    const session = {};\n    if (params.length !== 1) throw new Error(\"request params array should have only one element\");\n    const {\n      startUrl,\n      popupUrl,\n      method,\n      allowedInteractions\n    } = args;\n    if (allowedInteractions.length === 0) throw new Error(\"no allowed interactions\");\n\n    if (this.state.clientId) {\n      session._clientId = this.state.clientId;\n    }\n\n    if (this.privKey) {\n      const userData = {\n        clientId: session._clientId,\n        timestamp: Date.now().toString()\n      };\n      const sig = await sign(Buffer.from(this.privKey, \"hex\"), Buffer.from(keccak(\"keccak256\").update(JSON.stringify(userData)).digest(\"hex\"), \"hex\"));\n      session._user = getPublic(Buffer.from(this.privKey, \"hex\")).toString(\"hex\");\n      session._userSig = base64url.encode(sig);\n      session._userData = userData;\n    }\n\n    session._originData = this.state.originData;\n    session._whiteLabelData = this.state.whiteLabel;\n    session._loginConfig = this.state.loginConfig; // add in session data (allow overrides)\n\n    params = [_objectSpread(_objectSpread({}, session), params[0])]; // use JRPC where possible\n\n    if (this.state.support3PC && allowedInteractions.includes(ALLOWED_INTERACTIONS.JRPC)) {\n      return this._jrpcRequest({\n        method,\n        params\n      });\n    } // set origin\n\n\n    params[0]._origin = new URL((_params$0$redirectUrl = params[0].redirectUrl) !== null && _params$0$redirectUrl !== void 0 ? _params$0$redirectUrl : this.state.redirectUrl).origin; // preset params\n\n    if (this.state.support3PC) {\n      // set params first if 3PC supported\n      await this._setPIDData(pid, params); // eslint-disable-next-line require-atomic-updates\n\n      params = [{}];\n    }\n\n    if (!startUrl || !popupUrl) {\n      throw new Error(\"no url for redirect / popup flow\");\n    } // method and pid are always in URL hash params\n    // convert params from JSON to base64\n\n\n    if (this.state.uxMode === UX_MODE.REDIRECT) {\n      // if redirects preferred, check for redirect flows first, then check for popup flow\n      if (allowedInteractions.includes(ALLOWED_INTERACTIONS.REDIRECT)) {\n        // give time for synchronous methods to complete before redirect\n        setTimeout(() => {\n          window.location.href = constructURL({\n            baseURL: startUrl,\n            hash: {\n              b64Params: jsonToBase64(params[0]),\n              _pid: pid,\n              _method: method\n            }\n          });\n        }, 50);\n        return {};\n      }\n\n      if (allowedInteractions.includes(ALLOWED_INTERACTIONS.POPUP)) {\n        const u = new URL(constructURL({\n          baseURL: popupUrl,\n          hash: {\n            b64Params: jsonToBase64(params[0]),\n            _pid: pid,\n            _method: method\n          }\n        }));\n        const windowRef = window.open(u.toString(), \"_blank\", getPopupFeatures());\n        return awaitReq(pid, windowRef);\n      }\n    } else {\n      // if popups preferred, check for popup flows first, then check for redirect flow\n      if (allowedInteractions.includes(ALLOWED_INTERACTIONS.POPUP)) {\n        const u = new URL(constructURL({\n          baseURL: popupUrl,\n          hash: {\n            b64Params: jsonToBase64(params[0]),\n            _pid: pid,\n            _method: method\n          }\n        }));\n        const windowRef = window.open(u.toString(), \"_blank\", getPopupFeatures());\n        return awaitReq(pid, windowRef);\n      }\n\n      if (allowedInteractions.includes(ALLOWED_INTERACTIONS.REDIRECT)) {\n        // give time for synchronous methods to complete before redirect\n        setTimeout(() => {\n          window.location.href = constructURL({\n            baseURL: startUrl,\n            hash: {\n              b64Params: jsonToBase64(params[0]),\n              _pid: pid,\n              _method: method\n            }\n          });\n        }, 50);\n        return null;\n      }\n    }\n\n    throw new Error(\"no matching allowed interactions\");\n  }\n\n  async _jrpcRequest(args) {\n    // await this.initialized;\n    if (!args || typeof args !== \"object\" || Array.isArray(args)) {\n      throw new Error(\"invalid request args\");\n    }\n\n    const {\n      method,\n      params\n    } = args;\n\n    if (typeof method !== \"string\" || method.length === 0) {\n      throw new Error(\"invalid request method\");\n    }\n\n    if (params === undefined || !Array.isArray(params)) {\n      throw new Error(\"invalid request params\");\n    }\n\n    if (params.length === 0) {\n      params.push({});\n    }\n\n    return new Promise((resolve, reject) => {\n      this.provider._rpcRequest({\n        method,\n        params\n      }, getRpcPromiseCallback(resolve, reject));\n    });\n  }\n\n  async _check3PCSupport() {\n    return this._jrpcRequest({\n      method: OPENLOGIN_METHOD.CHECK_3PC_SUPPORT,\n      params: [{\n        _originData: this.state.originData\n      }]\n    });\n  }\n\n  async _setPIDData(pid, data) {\n    await this.request({\n      allowedInteractions: [ALLOWED_INTERACTIONS.JRPC],\n      method: OPENLOGIN_METHOD.SET_PID_DATA,\n      params: [{\n        pid,\n        data: data[0]\n      }]\n    });\n  }\n\n  async _getData() {\n    return this.request({\n      allowedInteractions: [ALLOWED_INTERACTIONS.JRPC],\n      method: OPENLOGIN_METHOD.GET_DATA,\n      params: [{}]\n    });\n  }\n\n  _syncState(newState) {\n    if (newState.store) {\n      if (typeof newState.store !== \"object\") {\n        throw new Error(\"expected store to be an object\");\n      }\n\n      Object.keys(newState.store).forEach(key => {\n        // if privKey is available then user is not logged out, but in popup mode store info is not available.\n        // so we don't want to overwrite the local store if privKey is available\n        // and if latest iframe store data is not available\n        if (newState.privKey) {\n          if (newState.store[key]) {\n            this.state.store.set(key, newState.store[key]);\n          }\n        } else {\n          this.state.store.set(key, newState.store[key]);\n        }\n      });\n    }\n\n    const {\n      store\n    } = this.state;\n    this.state = _objectSpread(_objectSpread(_objectSpread({}, this.state), newState), {}, {\n      store\n    });\n  }\n\n  async _modal(params) {\n    return new Promise((resolve, reject) => {\n      this.modal._prompt(this.state.clientId, this.state.whiteLabel, this.state.loginConfig, async chunk => {\n        if (chunk.cancel) {\n          reject(new Error(\"user canceled login\"));\n        } else {\n          try {\n            const selectedLoginResponse = await this._selectedLogin(merge(params, chunk));\n            resolve(selectedLoginResponse);\n          } catch (error) {\n            reject(error);\n          }\n        }\n      });\n    });\n  }\n\n  async _cleanup() {\n    await this.modal.cleanup();\n    this.provider.cleanup();\n  }\n\n  async encrypt(message, privateKey) {\n    let privKey = privateKey;\n\n    if (!privKey) {\n      privKey = this.privKey;\n    } // validations\n\n\n    if (!/^[0-9a-fA-f]{64}$/.exec(privKey)) {\n      if (privKey === \"\" || privKey === undefined) {\n        throw new Error(\"private key cannot be empty\");\n      } else {\n        throw new Error(\"invalid private key in encrypt\");\n      }\n    }\n\n    return encrypt(getPublic(Buffer.from(privKey, \"hex\")), message);\n  }\n\n  async decrypt(ciphertext, privateKey) {\n    let privKey = privateKey;\n\n    if (!privKey) {\n      privKey = this.privKey;\n    } // validations\n\n\n    if (!/^[0-9a-fA-f]{64}$/.exec(privKey)) {\n      if (privKey === \"\" || privKey === undefined) {\n        throw new Error(\"private key cannot be empty\");\n      } else {\n        throw new Error(\"invalid private key in decrypt\");\n      }\n    }\n\n    return decrypt(Buffer.from(privKey, \"hex\"), ciphertext);\n  }\n\n  async getUserInfo() {\n    if (this.privKey) {\n      const storeData = this.state.store.getStore();\n      const userInfo = {\n        email: storeData.email || \"\",\n        name: storeData.name || \"\",\n        profileImage: storeData.profileImage || \"\",\n        aggregateVerifier: storeData.aggregateVerifier || \"\",\n        verifier: storeData.verifier || \"\",\n        verifierId: storeData.verifierId || \"\",\n        typeOfLogin: storeData.typeOfLogin || \"\",\n        dappShare: storeData.dappShare || \"\"\n      };\n      return userInfo;\n    }\n\n    throw new Error(\"user should be logged in to fetch userInfo\");\n  }\n\n  async getEncodedLoginUrl(loginParams) {\n    const {\n      redirectUrl\n    } = loginParams;\n    const {\n      clientId\n    } = this.state;\n\n    if (!this.state.originData[origin]) {\n      await this.updateOriginData();\n    }\n\n    const dataObject = _objectSpread({\n      _clientId: clientId,\n      _origin: new URL(redirectUrl).origin,\n      _originData: this.state.originData,\n      redirectUrl\n    }, loginParams);\n\n    const b64Params = jsonToBase64(dataObject);\n    const hashParams = {\n      b64Params,\n      _method: \"openlogin_login\"\n    };\n    return constructURL({\n      baseURL: \"\".concat(this.state.iframeUrl, \"/start\"),\n      hash: hashParams\n    });\n  }\n\n}\n\nexport { ALLOWED_INTERACTIONS, LOGIN_PROVIDER, MFA_LEVELS, OPENLOGIN_METHOD, OPENLOGIN_NETWORK, OpenLoginStore, Provider, UX_MODE, awaitReq, constructURL, OpenLogin as default, documentReady, getHashQueryParams, getPopupFeatures, htmlToElement, localStorageAvailable, log as loglevel, modalDOMElementID, preloadIframe, sessionStorageAvailable, storageAvailable, storeKey, whitelistUrl };\n//# sourceMappingURL=openlogin.esm.js.map\n"]},"metadata":{},"sourceType":"module"}